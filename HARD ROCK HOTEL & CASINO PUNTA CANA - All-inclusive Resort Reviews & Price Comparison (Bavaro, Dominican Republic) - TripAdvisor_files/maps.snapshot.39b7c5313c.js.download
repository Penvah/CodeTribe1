(window.$WP=window.$WP||[]).push({id:"@ta/maps.snapshot",d:["vendor-babel","vendor-react-libs","ta-platform","ta-common","@ta/maps.provider-names"],e:["./packages/maps/snapshot/snapshot.jsx"],x:{"./packages/maps/snapshot/MapSnapshot.jsx":["a"],"./packages/maps/snapshot/assetCatalogue.jsx":["a"]},m:{"./packages/maps/snapshot/MapSnapshot.jsx":function(e,t,n){"use strict";var a=n("@babel/runtime/helpers/esm/classCallCheck"),s=n.n(a),o=n("@babel/runtime/helpers/esm/createClass"),i=n.n(o),r=n("@babel/runtime/helpers/esm/possibleConstructorReturn"),p=n.n(r),m=n("@babel/runtime/helpers/esm/getPrototypeOf"),c=n.n(m),l=n("@babel/runtime/helpers/esm/inherits"),u=n.n(l),h=n("@babel/runtime/helpers/esm/assertThisInitialized"),g=n.n(h),d=n("@babel/runtime/helpers/esm/defineProperty"),v=n.n(d),_=n("react"),f=n("react-redux"),b=n("@ta/common.logging"),P=n.n(b),k=n("@ta/common.tracking"),S=n.n(k),j=n("@ta/media.image"),R=function(e){function t(){var e,n;s()(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return n=p()(this,(e=c()(t)).call.apply(e,[this].concat(o))),v()(g()(g()(n)),"state",{snapshotUrl:null}),v()(g()(g()(n)),"urlRequest",void 0),v()(g()(g()(n)),"requestUrl",void 0),v()(g()(g()(n)),"requestTimeout",void 0),v()(g()(g()(n)),"mounted",void 0),n}return u()(t,e),i()(t,[{key:"componentDidMount",value:function e(){this.mounted=!0,this.loadSnapshot()}},{key:"componentDidUpdate",value:function e(){this.loadSnapshot()}},{key:"componentWillUnmount",value:function e(){this.urlRequest=null,this.mounted=!1,clearTimeout(this.requestTimeout)}},{key:"loadSnapshot",value:function e(){var t=this;if(this.mounted){var n=this.buildUrl();n&&this.requestUrl!==n&&(this.requestUrl=n,clearTimeout(this.requestTimeout),this.requestTimeout=setTimeout(function(){if(t.mounted){var e=fetch(n,{credentials:"same-origin"});t.urlRequest=e,t.urlRequest.then(function(e){return e.json()}).then(function(n){e===t.urlRequest&&(t.setState({snapshotUrl:n.url}),S()({module:"staticmap",action:"load",context:n.mapProvider}))}).catch(function(e){t.setState({snapshotUrl:null}),S()({module:"staticmap",action:"failed",context:n}),P.a.error("Error loading snapshot",e)})}},100))}}},{key:"buildUrl",value:function e(){var t=this.props;if((t.width||0)<1||(t.height||0)<1)return P.a.error("StaticMapSnapshot - Width (".concat(t.width,") and height (").concat(t.height,") params must be positive values")),null;if(t.zoom<1||t.zoom>19)return P.a.error("StaticMapSnapshot - Zoom (".concat(t.width,") must be between 1 and 19.")),null;var n=function e(t){var n=[];return Object.keys(t).forEach(function(e){var a=t[e];if(null!=a){var s=a.toString();n.push([encodeURIComponent(e),encodeURIComponent(s)].join("="))}}),n.join("&")}({center:[t.center.lat,t.center.lng].join(","),width:t.width,height:t.height,zoom:t.zoom,geoId:t.geoId,servletName:t.servletName,scale:t.scale,forceMapProvider:t.forceMapProvider});return this.props.markers.length&&(n+="&".concat(function e(t){var n={};return t&&t.length?(t.forEach(function(e){var t=e.iconUrl,a=[e.position.lat,e.position.lng];n[t]?n[t].push(a):n[t]=[a]}),Object.keys(n).map(function(e){return"markers=".concat(e,"|").concat(n[e].join("|"))}).join("&")):""}(this.props.markers))),"/data/1.0/maps/staticmap?".concat(n)}},{key:"render",value:function e(){var t=this.props;return _.createElement("span",{"data-test-target":"staticMapSnapshot",className:t.className},this.state.snapshotUrl&&(t.lazy?_.createElement(j.LazyImage,{className:t.imgClassName,src:this.state.snapshotUrl,alt:""}):_.createElement("img",{className:t.imgClassName,src:this.state.snapshotUrl})))}}]),t}(_.Component);v()(R,"defaultProps",{alt:"",className:"",imgClassName:"",scale:1,forceMapProvider:null,markers:[]}),t.a=Object(f.connect)(function(e){return{geoId:e.page.geoId,servletName:e.meta.initialServletName}})(R)},"./packages/maps/snapshot/assetCatalogue.jsx":function(e,t,n){"use strict";t.a={attractionPin:"img2/maps/icons/component_map_pins_v1/A_Pin_Small.png",miniAttractionPin:"img2/maps/icons/component_map_pins_v1/A_Pin_xs.png",anchorAttractionPin:"img2/maps/icons/responsive_map_pins_v2/AR_Anchor_pin.png",hotelPin:"img2/maps/icons/component_map_pins_v1/H_Pin_Small.png",miniHotelPin:"img2/maps/icons/component_map_pins_v1/H_Pin_xs.png",anchorHotelPin:"img2/maps/icons/responsive_map_pins_v2/H_Anchor_pin.png",restaurantPin:"img2/maps/icons/component_map_pins_v1/R_Pin_Small.png",miniRestaurantPin:"img2/maps/icons/component_map_pins_v1/R_Pin_xs.png",anchorRestaurantPin:"img2/maps/icons/responsive_map_pins_v2/R_Anchor_pin.png",rentalPin:"img2/maps/icons/responsive_map_pins_v1/VR_green_pin.png",anchorRentalPin:"img2/maps/icons/responsive_map_pins_v2/VR_Anchor_pin.png"}},"./packages/maps/snapshot/snapshot.jsx":function(e,t,n){"use strict";n.r(t);var a=n("./packages/maps/snapshot/MapSnapshot.jsx"),s=n("@ta/maps.provider-names");for(var o in s)["SnapshotAssetCatalogue","default"].indexOf(o)<0&&function(e){n.d(t,e,function(){return s[e]})}(o);var i=n("./packages/maps/snapshot/assetCatalogue.jsx");n.d(t,"SnapshotAssetCatalogue",function(){return i.a}),t.default=a.a}}});
//# sourceMappingURL=maps.snapshot.39b7c5313c.js.map