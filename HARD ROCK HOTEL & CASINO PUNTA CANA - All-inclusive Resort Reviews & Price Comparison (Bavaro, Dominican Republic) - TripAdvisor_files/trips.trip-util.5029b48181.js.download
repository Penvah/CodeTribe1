(window.$WP=window.$WP||[]).push({id:"@ta/trips.trip-util",d:["vendor-babel","ta-platform","@ta/trips.trip-types","@ta/social.feed","@ta/trips.graphql"],e:["./packages/trips/trip-util/trip-util.jsx"],x:{"./packages/trips/trip-util/trip-util.jsx":["getTripCoverPhoto","getTripUsers","isTripUser","userTypeFromTrip","getTripPermissions","getCollabPermissions","getItemPermissions","getCommentPermissions","getTripUsersForDisplay","getCommentsForDisplay","isOwner","getItemByReference","getItemIdByReference","saveObjectExistsInTrip","itemExistsInTrip","updateSocialStatisticsOnSave","updateSocialStatisticsOnUnsave","getReferenceTypeFromObjectType","toSavesObject","toReference","buildPublicTripShareUrl","objectStatisticQuery","isRepostSaveable"]},m:{"./packages/trips/trip-util/trip-util.jsx":function(t,e,i){"use strict";i.r(e),i.d(e,"getTripCoverPhoto",function(){return p}),i.d(e,"getTripUsers",function(){return l}),i.d(e,"isTripUser",function(){return f}),i.d(e,"userTypeFromTrip",function(){return m}),i.d(e,"getTripPermissions",function(){return b}),i.d(e,"getCollabPermissions",function(){return g}),i.d(e,"getItemPermissions",function(){return v}),i.d(e,"getCommentPermissions",function(){return y}),i.d(e,"getTripUsersForDisplay",function(){return S}),i.d(e,"getCommentsForDisplay",function(){return j}),i.d(e,"isOwner",function(){return O}),i.d(e,"getItemByReference",function(){return I}),i.d(e,"getItemIdByReference",function(){return P}),i.d(e,"saveObjectExistsInTrip",function(){return T}),i.d(e,"itemExistsInTrip",function(){return h}),i.d(e,"updateSocialStatisticsOnSave",function(){return w}),i.d(e,"updateSocialStatisticsOnUnsave",function(){return C}),i.d(e,"getReferenceTypeFromObjectType",function(){return k}),i.d(e,"toSavesObject",function(){return x}),i.d(e,"toReference",function(){return A}),i.d(e,"buildPublicTripShareUrl",function(){return B}),i.d(e,"objectStatisticQuery",function(){return z}),i.d(e,"isRepostSaveable",function(){return D});var r=i("@babel/runtime/helpers/esm/defineProperty"),n=i.n(r),o=i("@babel/runtime/helpers/esm/objectSpread"),a=i.n(o),c=i("@ta/common.global"),s=i("@ta/common.features"),u=(i("@ta/trips.trip-types"),i("@ta/social.feed")),d=i("@ta/trips.graphql"),p=function t(e){return e.photo&&e.photo.photoSizes[e.photo.photoSizes.length-1]?e.photo.photoSizes[e.photo.photoSizes.length-1]:null},l=function t(e){var i=e.owner||e.userProfile,r=i?[i]:[];if(Object(s.featureIsEnabled)("trips_2018_collab")){var n=(e.collaborators||[]).map(function(t){return t.user}).filter(Boolean);r=r.concat(n)||[]}return r},f=function t(e,i){return l(e).some(function(t){return t.isMe||t.userId&&t.userId===i||t.id&&t.id===i})},m=function t(e){var i;return(null===(i=e.owner)||void 0===i?void 0:i.isMe)?"OWNER":e&&f(e)?"COLLABORATOR":"PUBLIC"},b=function t(e,i){return Object(s.featureIsEnabled)("trips_2018_collab")?e.actionPermissions:{canAddCollaborators:i,canAddItem:i,canChangePrivacy:i,canDelete:i,canEdit:i,canUploadCoverPhoto:e.actionPermissions&&e.actionPermissions.canUploadCoverPhoto&&i}},g=function t(e,i){return Object(s.featureIsEnabled)("trips_2018_collab")?e.actionPermissions:{canRemove:i}},v=function t(e,i){return Object(s.featureIsEnabled)("trips_2018_collab")?e.actionPermissions:{canAddComment:i,canEdit:i,canRemove:i}},y=function t(e,i){return Object(s.featureIsEnabled)("trips_2018_collab")?e.actionPermissions:{canEdit:i,canRemove:i}},S=function t(e,i,r,n){var o=l(e);if(o=o.slice(0,i),r>0){var a=0;o=o.filter(function(t){return(a=t.displayName.length+a)<r})}return n&&(o=o.reverse()),o},j=function t(e,i,r){var n=r&&r.id,o=Object(s.featureIsEnabled)("trips_2018_collab")?function(){return!0}:function(t){return t.author.id===n||"ITEM"===t.targetType&&t.targetId!==e.id};return(i||[]).filter(o).sort(function t(e,i){return e.created>i.created?1:-1})},O=function t(e){var i;return null==e?void 0:null===(i=e.owner)||void 0===i?void 0:i.isMe},I=function t(e,i){return(e.items||[]).find(function(t){var e,r=t.reference&&t.reference.type&&t.reference.type.toLowerCase(),n=null===(e=t.reference)||void 0===e?void 0:e.id,o=i.type.toLowerCase(),a=i.id.toString(),c=i.originalObject&&i.originalObject.type&&i.originalObject.type.toLowerCase(),s=i.originalObject&&i.originalObject.id.toString();return r===o&&n===a||r===c&&n===s})},P=function t(e,i){var r=I(e,i);return r?r.id:null},F=function t(e,i){return"savesItem"===i.type?e.id===i.id:"location"===i.type?!!e.object&&e.object.locationId&&e.object.locationId.toString()===i.id.toString():"attractionProduct"===i.type?!!e.object&&e.object.attractionProductId&&e.object.attractionProductId.toString()===i.id.toString():!!e.reference&&e.reference.type===i.type&&e.reference.id===i.id.toString()},T=function t(e,i){return!!(e.items||[]).find(function(t){return F(t,i)||!!i.originalObject&&F(t,i.originalObject)})},h=function t(e,i){return!!(e.items||[]).find(function(t){return!(!t.reference||!i.reference)&&t.reference.id===i.reference.id&&t.reference.type===i.reference.type})},_={savesItem:{fragment:d.TripItemStatisticFields,fragmentName:"TripItemStatisticFields",dataTypename:"TripItem"},link:{fragment:u.FeedObjectStatisticFieldsFragment,fragmentName:"FeedObjectStatisticFields",dataTypename:"LinkPost"},photo:{fragment:u.FeedObjectStatisticFieldsFragment,fragmentName:"FeedObjectStatisticFields",dataTypename:"Photo"},video:{fragment:u.FeedObjectStatisticFieldsFragment,fragmentName:"FeedObjectStatisticFields",dataTypename:"Video"},review:{fragment:u.FeedObjectStatisticFieldsFragment,fragmentName:"FeedObjectStatisticFields",dataTypename:"Review"},repost:{fragment:u.FeedObjectStatisticFieldsFragment,fragmentName:"FeedObjectStatisticFields",dataTypename:"Repost"}},R=function t(e,i,r,o){var s=_[i.type];if(s){var u,d=s.fragment,p=s.fragmentName,l=s.dataTypename,f="".concat(l,":").concat(i.id),m=e.readFragment({id:f,fragment:d,fragmentName:p}),b=Object(c.getObjectIdField)(l),g=((null==m?void 0:m.socialStatistics)||{}).tripCount,v=o(void 0===g?r:g);e.writeFragment({id:f,fragment:d,fragmentName:p,data:(u={__typename:l},n()(u,b,i.id),n()(u,"socialStatistics",a()({},m.socialStatistics,{isSaved:v>0,tripCount:v,__typename:"SocialStatistics"})),u)})}},w=function t(e,i){return R(e,i,0,function(t){return t+1})},C=function t(e,i){return R(e,i,1,function(t){return t-1})},E={locationinformation:"location",attractionproductinformation:"attractionProduct",forumpost:"post",tripitem:"savesItem",linkpost:"link",photo:"photo",video:"video",review:"review",repost:"repost"},L=function t(e){return{statQuery:e}},U=Object.freeze({location:L(d.LocationStatistics),attractionProduct:L(d.AttractionStatistics),post:L(d.ForumStatistics),savesItem:L(d.TripItemStatistics),link:L(d.LinkPostStatistics),review:L(d.ReviewStatistics),photo:L(d.PhotoStatistics),video:L(d.VideoStatistics),repost:L(d.RepostStatistics)}),k=function t(e){return E[e.toLowerCase()]},N=["LocationInformation","AttractionProductInformation","ForumPost","LinkPost","Review","Photo","Video","Repost"],x=function t(e){if(!e)return null;var i=Object(c.getObjectId)(e),r=k(e.__typename);if(i&&r){if(N.includes(e.__typename))return{type:r,id:i};if("TripItem"===e.__typename&&e.reference&&e.reference.id&&e.reference.type)return{type:r,id:i,originalObject:{id:e.reference.id,type:"attractionproduct"===e.reference.type?"attractionProduct":e.reference.type}}}return null},A=function t(e){return{id:"".concat(e.id),type:e.type}},B=function t(e,i){var r=i?"?itemId=".concat(i):"";return"/Trips/".concat(e).concat(r)},z=function t(e){var i=U[e.type];return i?e&&{query:i.statQuery,variables:{ids:[e.id]}}:null},D=function t(e){var i,r;return["LinkPost","Photo","Review","Video"].includes(null==e?void 0:null===(i=e.object)||void 0===i?void 0:null===(r=i.repostedObject)||void 0===r?void 0:r.__typename)}}}});
//# sourceMappingURL=trips.trip-util.5029b48181.js.map