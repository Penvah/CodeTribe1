(window.$WP=window.$WP||[]).push({id:"@ta/trips.create-trip-modal",d:["vendor-react-libs","@ta/trips.trip-types","vendor-babel","vendor-apollo-libs","ta-platform","@ta/overlays.modal","@ta/overlays.managers","@ta/overlays.headers","@ta/input.text-input","ta-common","@ta/social.login-gate","@ta/trips.graphql","@ta/trips.tracking","@ta/trips.privacy-control","@ta/trips.trip-errors","@ta/trips.trip-util","@ta/events.lifecycle"],e:["./packages/trips/create-trip-modal/index.jsx"],x:{"./packages/trips/create-trip-modal/index.jsx":["CreateTripModal","CreateTripWithAddItemModal","CreateTripWithMoveItemModal"]},m:{"./packages/trips/create-trip-modal/index.jsx":function(e,t,r){"use strict";r.r(t);var a=r("react"),i=(r("@ta/trips.trip-types"),r("@babel/runtime/helpers/esm/classCallCheck")),n=r.n(i),o=r("@babel/runtime/helpers/esm/createClass"),l=r.n(o),s=r("@babel/runtime/helpers/esm/possibleConstructorReturn"),c=r.n(s),p=r("@babel/runtime/helpers/esm/getPrototypeOf"),u=r.n(p),m=r("@babel/runtime/helpers/esm/inherits"),d=r.n(m),v=r("@babel/runtime/helpers/esm/assertThisInitialized"),_=r.n(v),f=r("@babel/runtime/helpers/esm/defineProperty"),T=r.n(f),b=r("react-redux"),h=r("react-apollo"),C=r("@ta/common.features"),g=r("@ta/overlays.modal"),E=r("@ta/overlays.managers"),y=r("@ta/overlays.headers"),M=r("@ta/common.i18n"),P=r("@ta/input.text-input"),I=r("@ta/styleguide.button"),N=r.n(I),O=r("@ta/styleguide.loading"),k=r("@ta/social.login-gate"),j=r("@ta/common.tracking"),S=r("@ta/trips.graphql"),B=r("@ta/trips.tracking"),L=r("@ta/trips.privacy-control"),D=r.n(L),A=r("@ta/trips.trip-errors"),w=function(e){function t(e){var r;return n()(this,t),r=c()(this,u()(t).call(this,e)),T()(_()(_()(r)),"onInputChange",function(e){var t=e.currentTarget;r.setState({form:Object.assign({},r.state.form,T()({},t.name,t.value)),error:null})}),T()(_()(_()(r)),"onPrivacyChange",function(e){r.setState({form:Object.assign({},r.state.form,{tripPrivacy:e}),error:null})}),T()(_()(_()(r)),"onCreateClick",function(e){r.isCreateDisabled()&&e.preventDefault()}),T()(_()(_()(r)),"getInitialStates",function(){return{form:{tripName:"",tripPrivacy:r.props.isPublicTrip?"PUBLIC":"PRIVATE"},error:null,impressionElement:"createTripModal"}}),T()(_()(_()(r)),"isCreateDisabled",function(){var e=r.state,t=e.error,a=e.form,i=a.tripName,n=a.tripPrivacy;return!!t||0===i.trim().length||!n}),r.state=r.getInitialStates(),r}return d()(t,e),l()(t,[{key:"onSubmit",value:function e(t,r,a){if(t.preventDefault(),this.validate()){var i=this.state.form,n=i.tripPrivacy,o={variables:{title:i.tripName,description:null,photoId:null,status:n}};"PUBLIC"!==n?a(o):r().then(function(){return a(o)})}}},{key:"onTripCreated",value:function e(t){this.setState(this.getInitialStates());var r=this.props.onTripCreated(t);r&&this.setState({error:r})}},{key:"validate",value:function e(){return!(this.state.form.tripName.trim().length>50&&(this.setState({error:Object(M.localize)("stat_modal_name_exceeds_50")}),1))}},{key:"render",value:function e(){var t=this,r=a.createElement("div",{className:"ui_label_group"},a.createElement("label",{className:"trips-create-trip-modal-CreateTripModalBase__label--1Pu4m",htmlFor:"tripName"},Object(M.localize)("stat_modal_trip_name"),a.createElement(P.TextInput,{name:"tripName",className:this.state.error?"trips-create-trip-modal-CreateTripModalBase__tripname_error--VzXmt":"trips-create-trip-modal-CreateTripModalBase__tripname--1N2ZB",focusOnMount:!0,onChange:this.onInputChange,value:this.state.form.tripName,maxLength:50})),a.createElement("div",{className:"trips-create-trip-modal-CreateTripModalBase__messages--1DXPW"},a.createElement("div",{className:"trips-create-trip-modal-CreateTripModalBase__error_message--2BmfH"},this.state.error),a.createElement("div",{className:"".concat("trips-create-trip-modal-CreateTripModalBase__length_hint--3JESK"," ").concat(this.state.form.tripName.length>=50?"trips-create-trip-modal-CreateTripModalBase__max_length_reached--2nkEr":"")},Object(M.localize)("trips_trip_name_character_count",{nCharacterCount:this.state.form.tripName.length})))),i=a.createElement(N.a,{type:"primary",disabled:this.isCreateDisabled(),onClick:this.onCreateClick},Object(M.localize)("stat_modal_create"));return a.createElement(j.Impression,{source:"trips",attributes:Object(B.getTripsImpression)({element:this.state.impressionElement})},a.createElement("div",{className:"ui_content ".concat("trips-create-trip-modal-CreateTripModalBase__content--2TEq1")},a.createElement(h.Mutation,{mutation:S.CreateTrip,onCompleted:function e(r){var a=r.createTrip.errors;if(a&&a.length){var i=a[0],n=Object(A.getLocalizedTripsErrorMessage)("CREATE_TRIP",i);"ILLEGAL_DUPLICATE"===i.type?t.setState({impressionElement:"duplicateTripError",error:n}):"FAILED_PROFANITY"===i.type?t.setState({error:n}):t.setState({impressionElement:"error",error:n})}else t.onTripCreated(r.createTrip.trip)},onError:function e(){t.setState({impressionElement:"error",error:Object(M.localize)("create_trip_general_error_v2")})}},function(e,n){var o=n.loading;return t.props.loading||o?a.createElement("div",{className:"trips-create-trip-modal-CreateTripModalBase__loading_container--2WTUp"},a.createElement(O.LoadingSpinner,null)):a.createElement(k.SocialLoginGate,null,function(n){return a.createElement("form",{onSubmit:function r(a){return t.onSubmit(a,n,e)},className:"trips-create-trip-modal-CreateTripModalBase__form--15Lh4"},r,!Object(C.featureIsEnabled)("saves_heart_with_wc_flow")&&t.props.canMakePublicTrip&&a.createElement("div",{className:"ui_label_group ".concat("trips-create-trip-modal-CreateTripModalBase__privacy--bmOIa")},a.createElement("label",{className:"trips-create-trip-modal-CreateTripModalBase__label--1Pu4m"},Object(M.localize)("trip_privacy_setting_header"),a.createElement("div",{className:"trips-create-trip-modal-CreateTripModalBase__privacy_component--1J_IL"},a.createElement(D.a,{className:"trips-create-trip-modal-CreateTripModalBase__privacy_component--1J_IL",name:"tripPrivacy",onSelect:t.onPrivacyChange,checkedValue:t.state.form.tripPrivacy})))),a.createElement("div",{className:"trips-create-trip-modal-CreateTripModalBase__button_footer--2cowQ"},i))})})))}}]),t}(a.PureComponent);T()(w,"defaultProps",{isPublicTrip:!1});var x=function(e){function t(e){var r;return n()(this,t),(r=c()(this,u()(t).call(this,e))).state={contentKey:r.getNewKey()},r}return d()(t,e),l()(t,[{key:"componentDidMount",value:function e(){this.props.isCurrentlyOpen&&this.props.isMobile&&window.scrollTo(0,0)}},{key:"onTripCreated",value:function e(t,r){return this.props.onTripCreated(t)||(r(),null)}},{key:"getNewKey",value:function e(){return"".concat(this.props.modalName).concat((new Date).getTime())}},{key:"render",value:function e(){var t=this;return a.createElement(g.Modal,{name:this.props.modalName,header:a.createElement(y.TitleBar,{iconName:"suitcase",displayType:"LEFT_ALIGN_GRAY"},Object(M.localize)("stat_modal_create_a_trip_v2")),onClose:function e(){t.setState({contentKey:t.getNewKey()}),t.props.onClose&&t.props.onClose()}},a.createElement(E.Closer,null,function(e){return a.createElement(w,{key:t.state.contentKey,onTripCreated:function r(a){return t.onTripCreated(a,e)},loading:t.props.loading,isPublicTrip:t.props.isPublicTrip,canMakePublicTrip:t.props.canMakePublicTrip})}))}}]),t}(a.PureComponent),z=Object(b.connect)(function(e){return{isMobile:"MOBILE"===e.meta.device.viewportCategory}})(x),R=function e(t){var r=t.onTripCreated,i=t.modalName,n=t.onClose,o=t.isCurrentlyOpen,l=t.isPublicTrip,s=t.canMakePublicTrip;return a.createElement(z,{onTripCreated:function e(t){return r(t),null},modalName:i,onClose:n,isCurrentlyOpen:o,isPublicTrip:l,canMakePublicTrip:s})};R.defaultProps={onClose:void 0,isPublicTrip:!1};var W=R,F=r("@ta/common.logging"),K=r.n(F),U=r("@ta/trips.trip-util"),q=r("@ta/events.lifecycle"),G=function e(t){var r=t.object,i=t.onAddedToCreatedTrip,n=t.onError,o=t.onMount,l=t.placement,s=t.canMakePublicTrip,c=Object(S.selectMutation)("ADD_ITEM",l);return a.createElement(h.Mutation,{mutation:null==c?void 0:c.mutation,displayName:null==c?void 0:c.displayName,update:function e(t){return Object(U.updateSocialStatisticsOnSave)(t,r)}},function(e,t){var l=t.loading;return a.createElement(B.TripInteraction,{source:"trips",saveObject:r,pageAsContext:!0},function(t){return a.createElement(a.Fragment,null,a.createElement(q.MountListener,{onComponentDidMount:o}),a.createElement(w,{onTripCreated:function a(o){t({modalSuccess:{element:"createTrip",privacy:o.status||void 0}}),e({variables:{tripId:o.id,referenceId:"".concat(r.id),referenceType:r.type,allowDuplicates:!1,socialReference:Object(C.featureIsEnabled)("social_at_referencing_profile_links")}}).then(function(e){var t,r,a,l,s=null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(r=t.addItemToTrip)||void 0===r?void 0:null===(a=r.errors)||void 0===a?void 0:null===(l=a[0])||void 0===l?void 0:l.error;return s?n&&n({query:"ADD_ITEM_TO_TRIP",tripsError:s}):i(o),null}).catch(function(e){return K.a.error(e),Object(M.localize)("create_trip_general_error_v2")})},loading:l,canMakePublicTrip:s}))})})};G.defaultProps={onError:void 0,placement:"DEFAULT"};var V=G,J=function e(t){var r=t.item,i=t.onMovedToCreatedTrip,n=t.placement,o=t.canMakePublicTrip,l=Object(S.selectMutation)("MOVE_ITEM",n),s=Object(U.toSavesObject)(r.object);return a.createElement(h.Mutation,{mutation:null==l?void 0:l.mutation,displayName:null==l?void 0:l.displayName},function(e,t){var n=t.loading;return a.createElement(B.TripInteraction,{source:"trips",saveObject:s,pageAsContext:!0},function(t){return a.createElement(w,{onTripCreated:function a(n){t({modalSuccess:{element:"createTrip",privacy:n.status||void 0}}),e({variables:{toTripId:n.id,itemId:r.id,socialReference:Object(C.featureIsEnabled)("social_at_referencing_profile_links")}}).then(function(){return i(n),null}).catch(function(e){return K.a.error(e),Object(M.localize)("trips_move_error")})},loading:n,canMakePublicTrip:o})})})};J.defaultProps={placement:"DEFAULT"};var X=J;r.d(t,"CreateTripModal",function(){return W}),r.d(t,"CreateTripWithAddItemModal",function(){return V}),r.d(t,"CreateTripWithMoveItemModal",function(){return X})}}});
//# sourceMappingURL=trips.create-trip-modal.3350851e62.js.map