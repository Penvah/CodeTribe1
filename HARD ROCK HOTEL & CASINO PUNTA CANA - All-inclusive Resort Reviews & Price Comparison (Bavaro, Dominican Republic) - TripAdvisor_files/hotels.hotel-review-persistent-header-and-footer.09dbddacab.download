(window.$WP=window.$WP||[]).push({id:"@ta/hotels.hotel-review-persistent-header-and-footer",d:["vendor-babel","vendor-react-libs","@ta/hotels.hotel-review-layout","ta-platform","@ta/hotels.hotel-offers","vendor-apollo-libs","ta-common","@ta/common.text","@ta/events.window-resize"],e:["./packages/hotels/hotel-review-persistent-header-and-footer/PersistentHeaderAndFooter.jsx"],x:{"./packages/hotels/hotel-review-persistent-header-and-footer/PersistentHeaderAndFooter.jsx":["default"]},m:{"./packages/hotels/hotel-review-persistent-header-and-footer/PersistentHeaderAndFooter.jsx":function(e,t,r){"use strict";r.r(t);var a=r("@babel/runtime/helpers/esm/classCallCheck"),n=r.n(a),o=r("@babel/runtime/helpers/esm/createClass"),i=r.n(o),s=r("@babel/runtime/helpers/esm/possibleConstructorReturn"),l=r.n(s),c=r("@babel/runtime/helpers/esm/getPrototypeOf"),d=r.n(c),u=r("@babel/runtime/helpers/esm/inherits"),f=r.n(u),h=r("@babel/runtime/helpers/esm/assertThisInitialized"),m=r.n(h),p=r("@babel/runtime/helpers/esm/defineProperty"),b=r.n(p),v=r("react"),_=r("react-redux"),w=r("@ta/hotels.hotel-review-layout"),g=r("@ta/common.classnames"),k=r.n(g),I=r("@ta/common.tracking"),E=r.n(I),O=r("@ta/common.features"),T=r("@ta/events.window-scroll"),S=r.n(T),y=r("@ta/hotels.hotel-offers"),N=r("@ta/common.i18n"),C=r.n(N),B=r("@babel/runtime/helpers/esm/objectSpread"),j=r.n(B),x=r("@babel/runtime/helpers/esm/toConsumableArray"),P=r.n(x),R=r("@ta/events.window-resize"),A=r.n(R),W=r("@ta/common.text"),L=r("@ta/styleguide.icon"),z=54,D=90,H="persistentheader",U="click";function V(e){switch(e){case"TOP":return"top";case"NEARBY":return"location";case"ABOUT_TAB":return"about";default:return e.toLowerCase()}}function F(e){E()({module:H,action:U,context:V(e)}),"TOP"===e&&window.scrollTo({top:0,behavior:"smooth"});var t=document.getElementById(e);if(t){var r=Object(O.featureIsEnabled)("hr_header_pivot_tests")?D:z,a=t.getBoundingClientRect(),n=window.pageYOffset;window.scrollTo({top:a.top+n-r,behavior:"smooth"})}}function M(){var e=window&&window.require;e&&e.defined("ta/Core/TA.Event")&&e(["ta/Core/TA.Event"],function(e){e&&e.on("TabHeaderWC_clickTab",F)})}function q(){var e=window&&window.require;e&&e.defined("ta/Core/TA.Event")&&e(["ta/Core/TA.Event"],function(e){e&&e.off("TabHeaderWC_clickTab",F)})}var G=F,Y=function e(t){var r=t.sectionId,a=t.innerRef,n=t.current,o=Object(W.unescapeHtml)(function i(e){switch(e){case"TOP":return Object(N.localize)("tabs_photos_fffff660");case"OVERVIEW":return Object(N.localize)("hr_tabs_overview_tab_fffff660");case"REVIEWS":return Object(N.localize)("tabs_reviews_fffff660");case"ANSWERS":return Object(N.localize)("qa_qanda");case"LOCATION":return Object(N.localize)("tabs_nearby_title_2_fffff660");case"NEARBY":return Object(N.localize)("mobile_nearby_af0");case"ROOMS":return Object(N.localize)("location_field_rooms");case"DEALS":return Object(N.localize)("common_Deals");case"ABOUT_TAB":return Object(N.localize)("hr_btf_about_header");case"PHOTOS":return Object(N.localize)("tabs_photos_fffff660");case"ROOMTIPS":return Object(N.localize)("tabs_room_tips_title_fffff661");default:return e}}(r));return v.createElement("div",{ref:a,key:r,onClick:function e(){return G(r)},className:k()("hotels-hotel-review-persistent-header-and-footer-Tab__tab--2xcfU",n?"hotels-hotel-review-persistent-header-and-footer-Tab__current--3GGvr":"")},v.createElement("span",{className:"hotels-hotel-review-persistent-header-and-footer-Tab__tab_title--2z4V3",title:o},o))},K=function e(t){var r,a=t.tabs,n=t.innerRef;return r=t.show?"":a&&Object.keys(a).length>0?"":"hotels-hotel-review-persistent-header-and-footer-Tab__hidden_tab--3PkSg",v.createElement("div",{ref:n,className:k()("hotels-hotel-review-persistent-header-and-footer-Tab__tab--2xcfU","hotels-hotel-review-persistent-header-and-footer-Tab__tabs_more--1Y00k",r),onClick:function e(){return E()({module:H,action:U,context:"more"})}},v.createElement("span",{className:"hotels-hotel-review-persistent-header-and-footer-Tab__tab_title--2z4V3"},Object(N.localize)("tabs_more_fffff660"),v.createElement("span",{className:"hotels-hotel-review-persistent-header-and-footer-Tab__more_arrow--2i5_K"},v.createElement(L.Icon,{name:"single-chevron-down"}))),v.createElement("div",{className:"hotels-hotel-review-persistent-header-and-footer-Tab__more_content--3zvl0"},a?Object.keys(a).map(function(e){return v.createElement(Y,{key:e,sectionId:e,current:a[e]})}):null))};K.defaultProps={show:!1},Y.defaultProps={innerRef:function e(){}};var Q=r("react-apollo"),Z={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ListPivotQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"locationIds"},value:{kind:"ListValue",values:[{kind:"Variable",name:{kind:"Name",value:"locationId"}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locationId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parent"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"accommodationCategory"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"popIndexDetails"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"popIndexTotal"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"overviewUrl"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:234}};Z.loc.source={body:"4319101b42a2"};var $=Z,J={loading:!1,hotelName:"",category:"HOTEL",parentName:"",listUrl:"",hotelCount:0},X=v.createContext(J),ee=Object(_.connect)(function(e){return{locationId:e.page.detailId}})(function e(t){var r=t.locationId,a=t.children;return Object(O.featureIsEnabled)("hr_header_pivot_tests")?v.createElement(Q.Query,{query:$,variables:{locationId:r},skip:!r||r<=0,errorPolicy:"all"},function(e){var t,r=e.loading,n=e.data;if(!r&&n&&n.locations&&n.locations[0]){var o,i,s=n.locations[0];t={loading:!1,hotelName:s.name||"",category:s.accommodationCategory||"HOTEL",parentName:(null===(o=s.parent)||void 0===o?void 0:o.name)||"",listUrl:s.overviewUrl||"",hotelCount:(null===(i=s.popIndexDetails)||void 0===i?void 0:i.popIndexTotal)||0}}else t=J;return v.createElement(X.Provider,{value:t},a)}):v.createElement(X.Provider,{value:J},a)}),te=function e(){var t=v.useContext(X),r=t.hotelName;return t.loading||!r?null:v.createElement("div",{className:"hotels-hotel-review-persistent-header-and-footer-HotelName__name--3MgG_",onClick:function e(){G("TOP")}},v.createElement("span",{className:"hotels-hotel-review-persistent-header-and-footer-HotelName__truncate--ku_oP"},r))},re=150,ae="_MORE",ne=function e(t){return t&&t.isIbOffer&&Object(O.featureIsEnabled)("om_affiliate_commerce_button_CTA")},oe=function(e){function t(e){var r;return n()(this,t),r=l()(this,d()(t).call(this,e)),b()(m()(m()(r)),"onScroll",function(){if(r.state.tabSectionIds&&r.state.tabSectionIds[0]){var e=P()(r.state.tabSectionIds).concat(P()(r.state.moreSectionIds)).reduce(function(e,t){var r=document.getElementById(t);return r?r.getBoundingClientRect().top-re>0?e:t:e},null);r.state.current!==e&&r.setState({current:e})}else r.state.current&&r.setState({current:null})}),b()(m()(m()(r)),"onResize",function(){if(r.container){var e=window.getComputedStyle(r.container),t=parseInt(e.getPropertyValue("width"),10)-parseInt(e.getPropertyValue("padding-left"),10)-parseInt(e.getPropertyValue("padding-right"),10);if(r.tabs&&r.commerceBlock){var a=r.state,n=a.tabSectionIds,o=a.moreSectionIds;r.updateTabWidths(n);var i=window.getComputedStyle(r.commerceBlock),s=n.reduce(function(e,t){return e+r.tabWidths[t]},0)+parseInt(i.getPropertyValue("width"),10);if(o&&o.length>0&&(s+=r.tabWidths[ae]),t<s){for(;t<s&&r.state.tabSectionIds.length>0;){var l=n.pop();if(!r.tabWidths[l]){var c=window.getComputedStyle(document.getElementById(l));r.tabWidths[l]=parseInt(c.getPropertyValue("width"),10)+1+parseInt(c.getPropertyValue("margin-left"),10)}o.unshift(l),1===o.length&&(s+=r.tabWidths[ae]),s-=r.tabWidths[l]}r.setState({tabSectionIds:P()(n),moreSectionIds:P()(o)})}else if(o.length>1&&t>=s+r.tabWidths[o[0]]||1===o.length&&t>=s-r.tabWidths[ae]+r.tabWidths[o[0]]){for(;o.length>1&&t>=s+r.tabWidths[o[0]]||1===o.length&&t>=s-r.tabWidths[ae]+r.tabWidths[o[0]];){var d=o.shift();n.push(d),s+=r.tabWidths[d]}r.setState({tabSectionIds:P()(n),moreSectionIds:P()(o)})}}}}),b()(m()(m()(r)),"getMiniOffer",function(){return r.props.metaOffer?v.createElement(y.MiniOffer,{data:r.props.metaOffer.data,priceText:r.props.metaOffer.priceText,providerDisplayName:r.props.metaOffer.providerDisplayName,status:r.props.metaOffer.status,buttonText:ne(r.props.metaOffer.data)?C()("affiliate_cta_book_get_rewards_v1"):void 0}):null}),b()(m()(m()(r)),"initialUpdate",function(){var e=window.getComputedStyle(r.tabs[ae]);r.tabWidths[ae]=parseInt(e.getPropertyValue("width"),10)+40,r.setState({firstRender:!1}),setTimeout(r.props.readyCallback,0)}),b()(m()(m()(r)),"updateTabWidths",function(e){e.forEach(function(e){if(r.tabs[e]){var t=window.getComputedStyle(r.tabs[e]);r.tabWidths[e]=parseInt(t.getPropertyValue("width"),10)+parseInt(t.getPropertyValue("margin-left"),10)}})}),b()(m()(m()(r)),"updateComp",function(){r.setState({current:null,tabSectionIds:r.props.tabSectionIds,moreSectionIds:[]}),setTimeout(function(){r.onScroll(),r.onResize()},0)}),b()(m()(m()(r)),"container",void 0),b()(m()(m()(r)),"tabs",void 0),b()(m()(m()(r)),"commerceBlock",void 0),b()(m()(m()(r)),"tabWidths",void 0),r.state={current:null,firstRender:!0,moreSectionIds:[],tabSectionIds:e.tabSectionIds},r.container=v.createRef(),r.tabs={},r.commerceBlock=v.createRef(),r.tabWidths={},r}return f()(t,e),i()(t,[{key:"componentDidMount",value:function e(){this.initialUpdate&&setTimeout(this.initialUpdate,0),M()}},{key:"componentDidUpdate",value:function e(t){if(t.tabSectionIds.length===this.props.tabSectionIds.length){for(var r=t.tabSectionIds.length;r--;)if(t.tabSectionIds[r]!==this.props.tabSectionIds[r])return void setTimeout(this.updateComp,0)}else setTimeout(this.updateComp,0)}},{key:"componentWillUnmount",value:function e(){q()}},{key:"render",value:function e(){var t=this,r=this.state.current;return v.createElement("div",{ref:function e(r){t.container=r},className:k()("ui_container","hotels-hotel-review-persistent-header-and-footer-Tabs__tab_bar_content_container--1tD5K")},Object(O.featureIsEnabled)("hr_header_pivot_tests")&&"DESKTOP"===this.props.viewport&&v.createElement(te,null),v.createElement("div",{className:"hotels-hotel-review-persistent-header-and-footer-Tabs__tabs--1G1aE"},this.state.tabSectionIds.map(function(e){return v.createElement(Y,{innerRef:function r(a){t.tabs=j()({},t.tabs,b()({},e,a))},key:e,sectionId:e,current:r===e})}),v.createElement(K,{innerRef:function e(r){t.tabs[ae]=r},tabs:this.state.moreSectionIds.reduce(function(e,r){return j()({},e,b()({},r,r===t.state.current))},{}),show:this.state.firstRender})),v.createElement("div",{ref:function e(r){t.commerceBlock=r},className:"hotels-hotel-review-persistent-header-and-footer-TabsDesktop__commerce--3-tZq"},v.createElement("div",{className:"hotels-hotel-review-persistent-header-and-footer-TabsDesktop__tabBarOffer--2vHD9"},this.getMiniOffer(),v.createElement("div",{className:"hotels-hotel-review-persistent-header-and-footer-TabsDesktop__hotelWebsite--2mU2Z"}))),v.createElement(A.a,{callback:this.onResize,throttle:100}),v.createElement(S.a,{callback:this.onScroll,throttle:100}))}}]),t}(v.Component),ie=150,se=["ABOUT_TAB","LOCATION","REVIEWS"],le=function(e){function t(){var e;return n()(this,t),e=l()(this,d()(t).call(this)),b()(m()(m()(e)),"onScroll",function(){var t,r="ABOUT_TAB",a=document.getElementById("LOCATION");if(a){var n=a.getBoundingClientRect().top-ie;n<=0&&(r="LOCATION",t=n)}var o=document.getElementById("REVIEWS");if(o){var i=o.getBoundingClientRect().top-ie;i<=0&&(!t||i>t)&&(r="REVIEWS")}e.state.current!==r&&e.setState({current:r})}),e.state={current:null},e}return f()(t,e),i()(t,[{key:"componentDidMount",value:function e(){this.onScroll&&setTimeout(this.onScroll,0),M()}},{key:"componentWillUnmount",value:function e(){q()}},{key:"render",value:function e(){var t=this;return v.createElement("div",{className:k()("ui_container","hotels-hotel-review-persistent-header-and-footer-Tabs__tab_bar_content_container--1tD5K")},v.createElement("div",{className:"hotels-hotel-review-persistent-header-and-footer-Tabs__tabs--1G1aE"},se.map(function(e){return v.createElement(Y,{key:e,current:t.state.current===e,sectionId:e})})),v.createElement(S.a,{callback:this.onScroll,throttle:100}))}}]),t}(v.Component),ce=function e(t,r,a){var n;switch(a){case"BB":n=Object(N.localize)("mobile_lite_detail_header_bar_see_all_bedandbreakfasts",{0:t});break;case"OTHER":n=Object(N.localize)("mobile_detail_header_bar_seeall_speciality_lodging",{0:t});break;case"HOTEL":default:n=r>0?Object(N.localize)("mobile_see_all_x_hotels_in_y",{0:"".concat(r),1:t}):Object(N.localize)("hotelshortlist_see_all_in_geo_ffffedfd",{0:t})}return Object(N.unescaped)(n)},de=function e(){var t=v.useContext(X),r=t.parentName,a=t.hotelCount,n=t.category,o=t.listUrl,i=t.loading,s=Object(O.featureIsEnabled)("hr_header_pivot_green");return!i&&r&&o?v.createElement("div",{className:k()("hotels-hotel-review-persistent-header-and-footer-BackToList__backToList--z9Gon",s?"hotels-hotel-review-persistent-header-and-footer-BackToList__greenVariation--1dF2C":"")},v.createElement("div",{className:"ui_container"},v.createElement(I.Track,{click:{module:"persistentheader",action:"click",context:"back_to_list",value:0},element:"span"},v.createElement("a",{href:o,className:"hotels-hotel-review-persistent-header-and-footer-BackToList__link--181Kq"},v.createElement(L.Icon,{name:"arrow-left",className:"hotels-hotel-review-persistent-header-and-footer-BackToList__arrowIcon--35QwD"}),ce(r,a,n))))):null},ue=function e(t){var r=t.viewport,a=v.useContext(X),n=a.parentName,o=a.listUrl,i=a.hotelCount,s=a.category,l=a.loading,c=v.createRef();return v.useEffect(function(){var e=document.querySelector(".breadcrumbs");e&&c.current&&(c.current.innerHTML=e.innerHTML)},[c]),l?null:v.createElement("div",{className:"hotels-hotel-review-persistent-header-and-footer-Breadcrumbs__breadcrumbs--1UdH8"},v.createElement("div",{className:"ui_container"},"MOBILE"===r?v.createElement(I.Track,{className:"hotels-hotel-review-persistent-header-and-footer-Breadcrumbs__seeAll--19u_L",click:{module:"persistentheader",action:"click",context:"back_to_list",value:0}},v.createElement("a",{href:o,className:"hotels-hotel-review-persistent-header-and-footer-Breadcrumbs__link--1CxbI"},v.createElement(L.Icon,{name:"arrow-left",className:"hotels-hotel-review-persistent-header-and-footer-Breadcrumbs__arrowIcon--1_UM8"}),ce(n,i,s))):v.createElement("ul",{ref:c}," ")))},fe=54,he=90,me="persistentheader",pe="in_view";function be(e,t){var r=document.getElementById(e),a=document.getElementById(t);return r&&a?r.getBoundingClientRect().top>a.getBoundingClientRect().top?1:-1:0}var ve=function e(t){return t&&t.isIbOffer&&Object(O.featureIsEnabled)("om_affiliate_commerce_button_CTA")},_e=function(e){function t(e){var r;return n()(this,t),r=l()(this,d()(t).call(this,e)),b()(m()(m()(r)),"onScroll",function(){if(r.state.ready){var e=Object(O.featureIsEnabled)("hr_header_pivot_tests")?he:fe;if(r.tabBar&&r.tabBar instanceof HTMLElement){var t=r.tabBar;if(r.state.shown&&r.lastInlineY>window.pageYOffset+e)r.setState({shown:!1});else if(!r.state.shown){var a=t.getBoundingClientRect().top;a-e<=0&&(r.lastInlineY=window.pageYOffset+a,r.setState({shown:!0}),E()({module:me,action:pe}))}}}}),b()(m()(m()(r)),"lastInlineY",void 0),b()(m()(m()(r)),"tabBar",void 0),r.state={shown:!1,ready:"MOBILE"===e.viewportCategory},r.tabBar=v.createRef(),r}return f()(t,e),i()(t,[{key:"componentDidMount",value:function e(){this.onScroll&&setTimeout(this.onScroll,0)}},{key:"componentDidUpdate",value:function e(t){if(t.tabSectionIds.length===this.props.tabSectionIds.length){for(var r=t.tabSectionIds.length;r--;)if(t.tabSectionIds[r]!==this.props.tabSectionIds[r])return void setTimeout(this.onScroll,0)}else setTimeout(this.onScroll,0)}},{key:"render",value:function e(){var t=this,r=this.state.shown,a=Object(O.featureIsEnabled)("hr_header_pivot_green")||Object(O.featureIsEnabled)("hr_header_pivot_white"),n=Object(O.featureIsEnabled)("hr_header_pivot_breadcrumb"),o=a||n;return v.createElement("div",{ref:function e(r){t.tabBar=r}},v.createElement(ee,null,v.createElement("div",{className:k()("hotels-hotel-review-persistent-header-and-footer-PersistentHeaderAndFooter__tab_bar--31rm9",r?"hotels-hotel-review-persistent-header-and-footer-PersistentHeaderAndFooter__fixed--8x8LO":"",o?"hotels-hotel-review-persistent-header-and-footer-PersistentHeaderAndFooter__pivotTest--20o5V":"")},a&&v.createElement(de,null),n&&v.createElement(ue,{viewport:this.props.viewportCategory}),"MOBILE"===this.props.viewportCategory?v.createElement(le,null):v.createElement(oe,{tabSectionIds:this.props.tabSectionIds,readyCallback:function e(){return t.setState({ready:!0})},metaOffer:this.props.offer,viewport:this.props.viewportCategory}))),v.createElement("div",{className:k()("hotels-hotel-review-persistent-header-and-footer-PersistentHeaderAndFooter__ui_persistent_footer--1MGGe",r?"hotels-hotel-review-persistent-header-and-footer-PersistentHeaderAndFooter__fixed--8x8LO":"")},"MOBILE"===this.props.viewportCategory&&this.props.offer?v.createElement(y.MobileFooterOffer,{show:r,data:this.props.offer.data,providerDisplayName:this.props.offer.providerDisplayName,priceText:this.props.offer.priceText,strikeThroughText:this.props.offer.strikeThroughText,status:this.props.offer.status,buttonText:ve(this.props.offer.data)?C()("affiliate_cta_book_get_rewards_v1"):void 0}):null),v.createElement(S.a,{callback:this.onScroll,throttle:100}))}}]),t}(v.Component),we=Object(_.connect)(function(e){return{tabSectionIds:Object.keys(Object(w.sectionState)(e).sectionIds).filter(function(t){return!!Object(w.sectionState)(e).sectionIds[t]}).sort(be),viewportCategory:e.meta.device.viewportCategory}})(_e);t.default=Object(y.bindToHotelReview)({stagingProcs:[],ssrQueriesList:[],listingFields:["chevronOffers","noAvailabilityLink","parentGeoName"],offerFields:["data","providerLogoUrl","strikeThroughText","savePriceText","providerDisplayName","priceText","status"]},Object(O.featureIsEnabled)("mobile_web_phone")?"resp_hr_persistent_footer":"resp_hr_tab_bar_offer",function(e){var t=e.listing&&e.listing.chevronOffers&&e.listing.chevronOffers[0]?e.listing.chevronOffers[0]:null;return v.createElement(we,{offer:t})})}}});
//# sourceMappingURL=hotels.hotel-review-persistent-header-and-footer.09dbddacab.js.map