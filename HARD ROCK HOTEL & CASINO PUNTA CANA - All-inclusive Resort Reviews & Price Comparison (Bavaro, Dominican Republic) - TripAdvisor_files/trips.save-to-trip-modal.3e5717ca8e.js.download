(window.$WP=window.$WP||[]).push({id:"@ta/trips.save-to-trip-modal",d:["vendor-babel","vendor-react-libs","ta-platform","@ta/trips.tracking","@ta/trips.trip-types","vendor-apollo-libs","@ta/trips.trip-util","@ta/trips.graphql","ta-common","@ta/trips.bookmark-icon","@ta/trips.privacy-icon","@ta/common.infinite-loader","@ta/social.show-more"],e:["./packages/trips/save-to-trip-modal/index.jsx"],x:{"./packages/trips/save-to-trip-modal/index.jsx":["SaveToTripContent"]},m:{"./packages/trips/save-to-trip-modal/index.jsx":function(e,t,r){"use strict";r.r(t);var o=r("@babel/runtime/helpers/esm/classCallCheck"),a=r.n(o),i=r("@babel/runtime/helpers/esm/createClass"),n=r.n(i),s=r("@babel/runtime/helpers/esm/possibleConstructorReturn"),l=r.n(s),c=r("@babel/runtime/helpers/esm/getPrototypeOf"),p=r.n(c),d=r("@babel/runtime/helpers/esm/inherits"),m=r.n(d),u=r("@babel/runtime/helpers/esm/assertThisInitialized"),v=r.n(u),f=r("@babel/runtime/helpers/esm/defineProperty"),_=r.n(f),b=r("react"),h=r("@ta/common.logging"),E=r.n(h),T=r("@ta/trips.tracking"),k=(r("@ta/trips.trip-types"),r("react-redux")),M=r("@ta/common.classnames"),C=r.n(M),S=r("@ta/common.tracking"),w=r("@ta/trips.trip-util"),g=r("@ta/common.infinite-loader"),y=r.n(g),I=r("@ta/social.show-more"),O=r("@ta/styleguide.icon"),j=r("@ta/common.i18n"),B=function e(t){return b.createElement(T.TripInteraction,{source:"trips",pageAsContext:!0},function(e){return b.createElement("div",{className:"trips-save-to-trip-modal-SaveToTripModalFooter__trip_stat_modal_footer--Am6hM",onClick:function r(){e({elementClick:{element:"stat_createTrip"}}),t.onClick()}},b.createElement(O.Icon,{name:"plus",className:"trips-save-to-trip-modal-SaveToTripModalFooter__trip_stat_modal_footer_button--Inxjt"}),b.createElement("span",{className:"trips-save-to-trip-modal-SaveToTripModalFooter__trip_stat_modal_footer_label--2_8Pc"},Object(j.localize)("stat_modal_create_a_trip_v2")))})},N=function(e){function t(){return a()(this,t),l()(this,p()(t).apply(this,arguments))}return m()(t,e),n()(t,[{key:"onCreateTripClicked",value:function e(){var t=this.props.onCreateTrip;t&&t()}},{key:"render",value:function e(){var t,r=this,o=this.props,a=o.tripList,i=o.savedSet,n=o.tripListBottom;if(0===a.length)return null;var s=a.slice().filter(function(e){var t=Object(w.isOwner)(e),r=Object(w.getTripPermissions)(e,!!t);return null==r?void 0:r.canAddItem});return b.createElement("div",{className:C()("trips-save-to-trip-modal-SaveToTripModalBase__trip_stat_modal--3FWrO",(t={},_()(t,"trips-save-to-trip-modal-SaveToTripModalBase__fullscreen_ie_safari_fix--2b2bW","IE"===this.props.browserFamily||"Safari"===this.props.browserFamily),_()(t,"trips-save-to-trip-modal-SaveToTripModalBase__disabled--1BenF",this.props.disabled),t))},b.createElement(S.Impression,{source:"trips",attributes:Object(T.getTripsImpression)({element:"statModal",trips:s,item:{saved:i.size>0}})},b.createElement(y.a,{loadMore:this.props.onPaginate,threshold:550,throttle:50,hasMore:this.props.hasMore,infiniteLoadOnMount:!1},function(e,t,o,a){return b.createElement("div",{className:"trips-save-to-trip-modal-SaveToTripModalBase__trip_stat_modal_list--3S6za",ref:e},b.createElement("ul",{ref:t},s.map(function(e){return b.createElement("li",{key:e.id},r.props.rowCreator(e))}),b.createElement("li",{className:"trips-save-to-trip-modal-SaveToTripModalBase__scrollButtonContainer--2HUgR"},b.createElement(I.ShowMore,{onClick:o,hasMore:r.props.hasMore,showButton:!a},null)),n&&b.createElement("li",{key:"bottom"},n)))})),b.createElement(B,{onClick:function e(){return r.onCreateTripClicked()}}))}}]),t}(b.PureComponent),P=Object(k.connect)(function(e){return{browserFamily:e.meta.device.browser.family}})(N),R=r("react-apollo"),A=r("@ta/common.features"),F=r("@ta/trips.graphql"),D=r("@ta/trips.bookmark-icon"),L=r("@ta/trips.privacy-icon"),x=r.n(L),U=function e(t){var r,o=t.trip,a=t.showBookmark,i=t.onClicked,n="PUBLIC"!==(null==o?void 0:o.tripStatus),s=Object(A.featureIsEnabled)("trips_skip_check_whitelist_public_trips")||(null===(r=o.actionPermissions)||void 0===r?void 0:r.canChangePrivacy);return b.createElement("div",{className:"trips-save-to-trip-modal-rows-SaveToTripModalRowBase__trip_stat_modal_item_container--JN5mn",onClick:function e(t){t.stopPropagation(),i()}},b.createElement("div",{className:"trips-save-to-trip-modal-rows-SaveToTripModalRowBase__image_container--2oLIu"},o.photo&&o.photo.photoSizes&&o.photo.photoSizes.length?b.createElement("img",{className:"trips-save-to-trip-modal-rows-SaveToTripModalRowBase__thumbnail--15C64",src:o.photo.photoSizes[1].url}):b.createElement("div",{className:"trips-save-to-trip-modal-rows-SaveToTripModalRowBase__thumbnail_placeholder--1pO8D"},b.createElement(O.Icon,{name:"suitcase"}))),b.createElement("div",{className:"trips-save-to-trip-modal-rows-SaveToTripModalRowBase__title_container--385YG"},!Object(A.featureIsEnabled)("saves_heart_with_wc_flow")&&s&&b.createElement(x.a,{isPrivate:n,borderless:!0,size:"small",className:"trips-save-to-trip-modal-rows-SaveToTripModalRowBase__private_icon--aNWnU"}),b.createElement("span",{className:"trips-save-to-trip-modal-rows-SaveToTripModalRowBase__title_label--2r845"},o.title),a&&b.createElement("span",{className:"trips-save-to-trip-modal-rows-SaveToTripModalRowBase__save_icon--3Ecgm"},b.createElement(D.BookmarkIcon,{active:!0,bookmarkStyle:"flat",bookmarkSize:"22"}))))};U.defaultProps={showBookmark:!1};var z=U,W=function e(t){var r=t.trip,o=t.itemId,a=t.showBookmark,i=t.onClick,n=t.onError,s=t.placement,l=Object(F.selectMutation)("MOVE_ITEM",s);return b.createElement(R.Mutation,{mutation:null==l?void 0:l.mutation,displayName:null==l?void 0:l.displayName},function(e){return b.createElement(z,{trip:r,onClicked:function t(){return function e(t){a||t({variables:{toTripId:r.id,itemId:o,socialReference:Object(A.featureIsEnabled)("social_at_referencing_profile_links")}}).then(function(e){var t,o,a=null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(o=t.moveTripItem)||void 0===o?void 0:o.errors;(null==a?void 0:a.length)?n&&n():i&&i(r)}).catch(function(e){E.a.error(e)})}(e)},showBookmark:a})})};W.defaultProps={onError:void 0,placement:"DEFAULT"};var q=W,V=function e(t){var r=t.object,o=t.onClick,a=t.onUnsave,i=t.onError,n=t.trip,s=t.placement,l=Object(F.selectMutation)("REMOVE_REFERENCE",s);return b.createElement(R.Mutation,{mutation:null==l?void 0:l.mutation,displayName:null==l?void 0:l.displayName,update:function e(t){return Object(w.updateSocialStatisticsOnUnsave)(t,r)}},function(e){return b.createElement(z,{trip:n,onClicked:function t(){return function e(t){o&&o(),t({variables:{reference:Object(w.toReference)(r),tripId:n.id,socialReference:Object(A.featureIsEnabled)("social_at_referencing_profile_links")}}).then(function(){a&&a(n,!1)}).catch(function(e){i&&i(e),E.a.error(e)})}(e)},showBookmark:!0})})};V.defaultProps={onClick:void 0,onUnsave:void 0,placement:"DEFAULT"};var J=V,$=function e(t){var r=t.trip,o=t.object,a=t.onSave,i=t.onError,n=t.onClick,s=t.placement,l=function e(t){var r,o,a,i;return null==t?void 0:null===(r=t.data)||void 0===r?void 0:null===(o=r.addItemToTrip)||void 0===o?void 0:null===(a=o.errors)||void 0===a?void 0:null===(i=a[0])||void 0===i?void 0:i.error},c=Object(F.selectMutation)("ADD_ITEM",s);return b.createElement(R.Mutation,{mutation:null==c?void 0:c.mutation,displayName:null==c?void 0:c.displayName,update:function e(t,r){l(r)||Object(w.updateSocialStatisticsOnSave)(t,o)}},function(e){return b.createElement(z,{trip:r,onClicked:function t(){return function e(t){n&&n(),t({variables:{tripId:r.id,referenceId:"".concat(o.id),referenceType:o.type,allowDuplicates:!1,socialReference:Object(A.featureIsEnabled)("social_at_referencing_profile_links")}}).then(function(e){var t=l(e);t?i&&i({query:"ADD_ITEM_TO_TRIP",tripsError:t}):a&&a(r,!0)}).catch(function(e){i&&i({query:"ADD_ITEM_TO_TRIP"}),E.a.error(e)})}(e)}})})};$.defaultProps={onClick:void 0,onSave:void 0,onError:void 0,placement:"DEFAULT"};var G=$,H=function e(t){return"number"==typeof t.id?t.id:parseInt(t.id,10)},Y=function(e){function t(){var e,r;a()(this,t);for(var o=arguments.length,i=new Array(o),n=0;n<o;n++)i[n]=arguments[n];return r=l()(this,(e=p()(t)).call.apply(e,[this].concat(i))),_()(v()(v()(r)),"state",{disabled:!1}),_()(v()(v()(r)),"enableModal",function(){r.setState({disabled:!1})}),_()(v()(v()(r)),"disableModal",function(){r.setState({disabled:!0})}),_()(v()(v()(r)),"doCallback",function(e,t,o){var a=new Set(r.props.savedSet);o?a.add(t.id):a.delete(t.id),e&&e(t,o,a.size>0)}),_()(v()(v()(r)),"rowCreator",function(e,t){var o=r.props,a=o.saveObject,i=o.tripAction,n=o.savedSet,s=o.onError,l=o.placement,c=H(a),p=n.has(e.id),d=function e(){return t({modalSuccess:{element:"stat"}})};if(p){var m=a&&b.createElement(J,{trip:e,object:a,onUnsave:function o(a,i){t({modalSuccess:{element:"unsave"}}),r.doCallback(r.props.onRemovedFromTrip,e,i)},onClick:r.disableModal,onError:r.enableModal,placement:l});return m||E.a.error("Unable to determine item id for object ".concat(JSON.stringify(a)," and trip ").concat(e.id)),m}return"MOVE"===i?b.createElement(q,{trip:e,itemId:c,onClick:function e(t){d(),r.disableModal(),r.doCallback(r.props.onMovedToTrip,t,!0)},showBookmark:p,onError:r.enableModal,placement:l}):"SAVE"===i?b.createElement(G,{trip:e,object:a,onSave:function t(o,a){d(),r.doCallback(r.props.onSavedToTrip,e,a)},onError:function e(t){r.enableModal(),s&&s(t)},onClick:r.disableModal,placement:l}):""}),r}return m()(t,e),n()(t,[{key:"componentDidMount",value:function e(){this.props.onMount&&this.props.onMount()}},{key:"render",value:function e(){var t=this;return b.createElement(T.TripInteraction,{source:"trips",pageAsContext:!0,saveObject:this.props.saveObject},function(e){return b.createElement(P,{tripList:t.props.tripList,savedSet:t.props.savedSet,hasMore:t.props.hasMore,tripListBottom:t.props.tripListBottom,rowCreator:function r(o){return t.rowCreator(o,e)},onCreateTrip:t.props.onCreateTrip,onPaginate:t.props.onPaginate,disabled:t.state.disabled})})}}]),t}(b.PureComponent);_()(Y,"defaultProps",{placement:"DEFAULT"});var K=Y;r.d(t,"SaveToTripContent",function(){return K})}}});
//# sourceMappingURL=trips.save-to-trip-modal.3e5717ca8e.js.map