(window.$WP=window.$WP||[]).push({id:"@ta/hotels.hotel-review-map",d:["vendor-babel","vendor-react-libs","ta-platform","@ta/maps.overlay","@ta/hotels.hotel-review-provider","@ta/public.maps","@ta/maps.alsoshowresults","@ta/common.poller","@ta/maps.fetch","@ta/maps.controls","@ta/maps.also-show-control","@ta/maps.find-location-button","@ta/maps.popups","@ta/maps.markers"],e:["./packages/hotels/hotel-review-map/MapOpener.jsx"],x:{"./packages/hotels/hotel-review-map/MapOpener.jsx":["default"]},m:{"./packages/hotels/hotel-review-map/MapOpener.jsx":function(e,t,o){"use strict";o.r(t);var a=o("@babel/runtime/helpers/esm/classCallCheck"),n=o.n(a),r=o("@babel/runtime/helpers/esm/createClass"),s=o.n(r),i=o("@babel/runtime/helpers/esm/possibleConstructorReturn"),l=o.n(i),c=o("@babel/runtime/helpers/esm/getPrototypeOf"),u=o.n(c),h=o("@babel/runtime/helpers/esm/inherits"),p=o.n(h),d=o("@babel/runtime/helpers/esm/assertThisInitialized"),m=o.n(d),v=o("@babel/runtime/helpers/esm/defineProperty"),f=o.n(v),w=o("react"),g=o("@ta/common.radio"),S=o.n(g),b=o("@ta/common.tracking"),k=o.n(b),y=o("@ta/maps.overlay"),M=o.n(y),L=o("@ta/hotels.hotel-review-provider"),E=o.n(L),C=o("@ta/common.features"),_=o("@ta/public.maps"),I=o("@ta/maps.alsoshowresults"),R=o("@babel/runtime/helpers/esm/objectSpread"),P=o.n(R),H=o("react-redux"),O=o("@ta/maps.controls"),A=o("@ta/maps.also-show-control"),B=o("@ta/maps.find-location-button"),x=o.n(B),N=o("@ta/maps.popups"),D=o("@ta/maps.markers"),j=function(e){function t(e){var o;return n()(this,t),o=l()(this,u()(t).call(this,e)),f()(m()(m()(o)),"alsoShowOptions",void 0),f()(m()(m()(o)),"onMapLoaded",function(e){o.setState({mapInterface:e.map,lastSearchBBox:e.map.getBounds()})}),f()(m()(m()(o)),"onLocationHoverStart",function(e){"DESKTOP"===o.props.viewportCategory&&o.setState(function(){return{hoveredMarker:e}})}),f()(m()(m()(o)),"onLocationHoverEnd",function(e){o.setState(function(t){return t.hoveredMarker&&t.hoveredMarker.id===e.id?{hoveredMarker:null}:null})}),f()(m()(m()(o)),"onPrimaryPinSelected",function(e){e?(o.state.visitedLocations[e.id]=!0,o.setState({selectedMarker:e,hoveredMarker:null,carouselState:o.props.detailLocation&&o.props.detailLocation.id===e.id?"selected_marker":"primary_results"})):o.setState({selectedMarker:null,hoveredMarker:null,carouselState:"hidden"})}),f()(m()(m()(o)),"onSecondaryPinSelected",function(e){e?(o.state.visitedLocations[e.id]=!0,o.setState({selectedMarker:e,hoveredMarker:null,carouselState:"selected_marker"})):o.setState({selectedMarker:null,hoveredMarker:null,carouselState:"hidden"})}),f()(m()(m()(o)),"onMapClick",function(){o.setState({selectedMarker:null,hoveredMarker:null,carouselState:"hidden"})}),f()(m()(m()(o)),"onRedoSearch",function(){var e=o.state.mapInterface;if(e){var t=e.getBounds();o.props.onRedoSearch(t),o.setState({lastSearchBBox:t})}else o.props.onRedoSearch(null)}),f()(m()(m()(o)),"onCarouselSwipe",function(e){var t=o.state.mapInterface;t&&t.panIntoView(new _.LatLng(e.geoPoint.latitude,e.geoPoint.longitude),{left:48,right:48,top:48,bottom:200}),o.setState({selectedMarker:e})}),f()(m()(m()(o)),"toggleAlsoShowOption",function(e,t){var a=Object.assign({},o.state.selectedAlsoShowOptions,f()({},e.value,t)),n=o.state.carouselState;e.value!==I.AlsoShowValues.hotels||t||"primary_results"!==o.state.carouselState||(n="hidden"),o.setState({selectedAlsoShowOptions:a,carouselState:n}),t&&o.onRedoSearch()}),f()(m()(m()(o)),"clearAlsoShowOptions",function(){var e=o.state.carouselState;"primary_results"===e&&(e="hidden"),o.setState({selectedAlsoShowOptions:{},carouselState:e})}),o.alsoShowOptions=Object(I.buildAlsoShowItems)([I.AlsoShowValues.hotels,I.AlsoShowValues.restaurants,I.AlsoShowValues.thingsToDo]),o.state={mapInterface:null,hoveredMarker:null,selectedMarker:void 0,carouselState:"hidden",hasFitResults:!1,selectedAlsoShowOptions:o.props.defaultAlsoShowOptions,visitedLocations:{},lastSearchBBox:null},"MOBILE"===e.viewportCategory&&(o.state.carouselState="selected_marker",o.state.selectedMarker=e.detailLocation),o}return p()(t,e),s()(t,[{key:"componentDidUpdate",value:function e(){if(!this.props.loading&&!this.state.hasFitResults){var t=this.state.mapInterface;if(t){var o=this.calcLatLngBounds();o&&t.setBounds(o,{left:50,right:50,top:50,bottom:50}),this.setState(P()({hasFitResults:!0},o?{lastSearchBBox:o}:{}))}}}},{key:"calcLatLngBounds",value:function e(){var t=this.props.nearbyHotels.map(function(e){return new _.LatLng(e.geoPoint.latitude,e.geoPoint.longitude)});return t.push(new _.LatLng(this.props.detailLocation.geoPoint.latitude,this.props.detailLocation.geoPoint.longitude)),t.length>=2?_.LatLngBounds.fromArray(t):null}},{key:"render",value:function e(){var t=this.props,o=t.detailLocation,a=t.onClose,n=this.state,r=n.selectedMarker,s=n.hoveredMarker,i=n.selectedAlsoShowOptions,l=n.visitedLocations,c=n.hasFitResults,u=s?s.id:0,h=r?r.id:0,p="DESKTOP"===this.props.viewportCategory,d="MOBILE"===this.props.viewportCategory,m=i[I.AlsoShowValues.hotels],v=Object.keys(i).filter(function(e){return i[e]}).length>0,f=null;"primary_results"===this.state.carouselState?f=this.props.nearbyHotels:"selected_marker"===this.state.carouselState&&r&&(f=[r]);var g=d&&f&&f.length;return w.createElement("div",{className:"hotels-hotel-review-map-HRMapview__container--ULPxh"},w.createElement(O.ModalHeader,{locationName:o.name,onClose:a}),w.createElement(_.MapComponent,{className:"hotels-hotel-review-map-HRMapview__mapContainer--3Pkl6",initialCenter:new _.LatLng(o.geoPoint.latitude,o.geoPoint.longitude),initialZoom:15,onLoad:this.onMapLoaded,onClick:this.onMapClick},w.createElement(I.AlsoShowResultsController,{blacklist:null,showSelectedMarker:d,selectedMarker:h,hoveredMarker:u,boundingBox:this.state.lastSearchBBox,isVisited:l,showRestaurants:i[I.AlsoShowValues.restaurants],showAttractions:i[I.AlsoShowValues.thingsToDo],showHotels:!1,onMarkerMouseEnter:this.onLocationHoverStart,onMarkerMouseLeave:this.onLocationHoverEnd,onMarkerClick:this.onSecondaryPinSelected}),w.createElement(D.AnchorMarkers,{locations:[o],hoveredMarker:u,selectedMarker:h,visited:{},showSelectedMarker:d,onMouseEnter:this.onLocationHoverStart,onMouseLeave:this.onLocationHoverEnd,onClick:this.onPrimaryPinSelected}),m&&w.createElement(D.PrimaryMarkers,{locations:this.props.nearbyHotels,hoveredMarker:u,selectedMarker:h,visited:l,showSelectedMarker:d,onMouseEnter:this.onLocationHoverStart,onMouseLeave:this.onLocationHoverEnd,onClick:this.onPrimaryPinSelected}),w.createElement("div",{className:"hotels-hotel-review-map-HRMapview__headerShadow--2LsJJ"}),p&&!!s&&s!==r&&w.createElement(N.LocationHoverPopup,{location:s}),m&&0===this.props.nearbyHotels.length&&!this.props.loading&&w.createElement("div",{className:"hotels-hotel-review-map-HRMapview__noResultsBanner--2Q5Zu"},w.createElement(O.NoResultsBanner,null)),!d&&r&&w.createElement(N.LocationPopup,{location:r,autoPan:!0}),g&&w.createElement(O.CardCarousel,{locations:f||[],selectedMarker:h,onSwipe:this.onCarouselSwipe}),m&&this.props.loading&&w.createElement("div",{className:"hotels-hotel-review-map-HRMapview__loadingBar--gfzGx"},w.createElement(O.LoadingBar,null)),w.createElement("div",{className:"hotels-hotel-review-map-HRMapview__zoomControl--9jjY8"},w.createElement(O.ZoomControl,null)),v&&c&&w.createElement("div",{className:"hotels-hotel-review-map-HRMapview__redoSearchContainer--ozYRO"},d?w.createElement(O.RoundedRedoSearchButton,{onRedoSearch:this.onRedoSearch}):w.createElement(O.RedoSearchButton,{onRedoSearch:this.onRedoSearch})),w.createElement("div",{className:"".concat("hotels-hotel-review-map-HRMapview__alsoShowContainer--1CLHm"," ").concat(g?"hotels-hotel-review-map-HRMapview__carouselShown--3YPUG":"")},w.createElement(A.AlsoShowControl,{options:this.alsoShowOptions,selectedValues:this.state.selectedAlsoShowOptions,onValueChange:this.toggleAlsoShowOption,onClearOptions:this.clearAlsoShowOptions,mobile:d})),w.createElement("div",{className:"".concat("hotels-hotel-review-map-HRMapview__findLocationButton--3aSUg"," ").concat(g?"hotels-hotel-review-map-HRMapview__carouselShown--3YPUG":"")},w.createElement(x.a,null))))}}]),t}(w.PureComponent),T=Object(H.connect)(function(e){return{viewportCategory:e.meta.device.viewportCategory}})(j),U=o("@ta/common.poller"),V=o.n(U),q=o("@ta/maps.fetch"),W=o.n(q),F=function(e){function t(){var e,o;n()(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return o=l()(this,(e=u()(t)).call.apply(e,[this].concat(r))),f()(m()(m()(o)),"state",{requestNumber:1}),f()(m()(m()(o)),"poll",function(){o.setState({requestNumber:o.state.requestNumber+1})}),f()(m()(m()(o)),"parseData",function(e,t){if(e){var o=e.hotels,a=e.hacStatus,n=a&&a.isHacComplete;if(o&&1===o.length){var r=o[0],s=r.offers&&r.offers.filter(function(e){return!!e.providerInfo}).map(function(e){return{offerClickToken:e.offerClickToken,price:e.price,status:e.status,provider:e.providerInfo.name,isInstantBook:e.providerInfo.isInstantBook}});return{location:{entityType:"hotel",id:r.location.id,geoPoint:r.location.geoPoint,numReviews:r.location.numReviews,thumbnail:r.location.thumbnail,name:r.location.name,bubbleRating:r.location.bubbleRating,detailUrl:r.location.detailUrl,popIndexText:r.popIndexMessage,listingKey:r.listingKey,offers:s,sponsoredListing:r.sponsoredListing},complete:n}}}return{location:null,complete:!!t}}),f()(m()(m()(o)),"renderWithResponse",function(e){var t=e.loading,a=e.data,n=e.error;return w.createElement(w.Fragment,null,w.createElement(V.a,{loading:t,complete:!!a&&a.complete,requestNumber:o.state.requestNumber,poll:o.poll}),o.props.children({loading:t,location:a?a.location:null,error:n}))}),o}return p()(t,e),s()(t,[{key:"render",value:function e(){var t="/data/1.0/mapsEnrichment/hotel/".concat(this.props.locationId),o=["rn=".concat(this.state.requestNumber),"rc=Hotel_Review","stayDates=".concat(this.props.stayDates),"guestInfo=".concat(this.props.guestInfo),"placementName=Hotel_Review_MapDetail_Anchor","currency=".concat(this.props.currencyCode)];this.props.fetchThumbnail&&o.push("getThumbnail=true");var a="".concat(t,"?").concat(o.join("&"));return w.createElement(W.a,{url:a,parser:this.parseData},this.renderWithResponse)}}]),t}(w.PureComponent);f()(F,"defaultProps",{fetchThumbnail:!1});var K=Object(H.connect)(function(e,t){var o=e.travelerInfo&&e.travelerInfo.hotels,a="",n="";return o&&(a=o.stayDates,n=o.guests),{locationId:t.locationId,stayDates:a,guestInfo:n,currencyCode:e.i18n.currencyCode}})(F),z=function e(t){if(t){var o=t.hotels,a=t.hacStatus,n=t.paging,r=a&&(a.isHacComplete||a.hacPercentComplete>90),s=0===n.totalItems||r;return{locations:o.map(function(e){var t=e.offers&&e.offers.map(function(e){return{offerClickToken:e.offerClickToken,price:e.price,status:e.status,provider:e.providerInfo&&e.providerInfo.name,isInstantBook:e.providerInfo&&e.providerInfo.isInstantBook}});return{entityType:"hotel",id:e.location.id,geoPoint:e.location.geoPoint,numReviews:e.location.numReviews,thumbnail:e.location.thumbnail,name:e.location.name,bubbleRating:e.location.bubbleRating,detailUrl:e.location.detailUrl,popIndexText:e.popIndexMessage,listingKey:e.listingKey,offers:t}}),complete:s}}return{locations:[],complete:!0}},Q=function e(t,o){var a=t.bbox,n=t.stayDates,r=t.guestInfo,s=t.geoId,i=t.centerLat,l=t.centerLng,c="/data/1.0/hotels/".concat(s).concat(a?"/proximity":""),u=["rn=".concat(o.requestNumber),"rc=Hotel_Review","stayDates=".concat(n),"guestInfo=".concat(r),"useExactFilters=true","placementName=Hotel_Review_MapDetail","pageSize=15","navArea=Meta_Map_Detail","currency=".concat(t.currencyCode)];return a?(u.push("sort=popularity"),u.push("minLat=".concat(a.southwest.lat)),u.push("maxLat=".concat(a.northeast.lat)),u.push("minLng=".concat(a.southwest.lng)),u.push("maxLng=".concat(a.northeast.lng))):(u.push("sort=distLow"),u.push("centerLat=".concat(i)),u.push("centerLng=".concat(l))),"".concat(c,"?").concat(u.join("&"))},Y=function(e){function t(){var e,o;n()(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return o=l()(this,(e=u()(t)).call.apply(e,[this].concat(r))),f()(m()(m()(o)),"state",{requestNumber:1}),f()(m()(m()(o)),"currentUrl",null),f()(m()(m()(o)),"poll",function(){o.setState({requestNumber:o.state.requestNumber+1})}),f()(m()(m()(o)),"renderWithResponse",function(e){var t=e.loading,a=e.data,n=e.error,r=z(a),s=(r.locations||[]).filter(function(e){return e.id!==o.props.detailId&&!!e.geoPoint});return w.createElement(w.Fragment,null,w.createElement(V.a,{loading:t,complete:r.complete,requestNumber:o.state.requestNumber,poll:o.poll}),o.props.children({loading:t||!r.complete&&o.state.requestNumber<15,locations:s,error:n}))}),o}return p()(t,e),s()(t,[{key:"componentDidUpdate",value:function e(){var t=Q(this.props,this.state);this.currentUrl!==t&&this.setState({requestNumber:1})}},{key:"render",value:function e(){var t=Q(this.props,this.state);return this.currentUrl=t,w.createElement(W.a,{url:t},this.renderWithResponse)}}]),t}(w.Component),G=Object(H.connect)(function(e){var t=e.travelerInfo&&e.travelerInfo.hotels,o="",a="";return t&&(o=t.stayDates,a=t.guests),{stayDates:o,guestInfo:a,currencyCode:e.i18n.currencyCode}})(Y),Z=function(e){function t(e){var o;return n()(this,t),o=l()(this,u()(t).call(this,e)),f()(m()(m()(o)),"radio",void 0),f()(m()(m()(o)),"performSearch",function(e){o.setState({searchBbox:e,searchEnabled:!0})}),f()(m()(m()(o)),"refreshPrices",function(){o.setState({anchorQueryKey:(new Date).toString()})}),o.state={searchBbox:null,anchorQueryKey:"initial",detailLocation:null,loading:!1,nearbyHotels:[],searchEnabled:Object(C.featureIsEnabled)("hr_location_hotel_pins")},o}return p()(t,e),s()(t,[{key:"componentDidMount",value:function e(){this.radio=S()("hr-map"),this.radio&&this.radio.on("refreshPrices",this.refreshPrices)}},{key:"componentWillUnmount",value:function e(){this.radio&&this.radio.off("refreshPrices",this.refreshPrices)}},{key:"render",value:function e(){var t,o=this,a=this.state,n=a.detailLocation,r=a.searchEnabled,s=Object(C.featureIsEnabled)("hr_react_map_default_nearby_r_a"),i=Object(C.featureIsEnabled)("hr_location_hotel_pins"),l=!Object(C.featureIsEnabled)("hotels_media_mas_maps");return w.createElement(w.Fragment,null,w.createElement(K,{key:this.state.anchorQueryKey,locationId:this.props.locationId,fetchThumbnail:l},function(e){var t=e.location;return t&&o.state.detailLocation!==t&&o.setState({detailLocation:t}),null}),n&&r&&w.createElement(G,{bbox:this.state.searchBbox,geoId:this.props.geoId,detailId:this.props.locationId,centerLat:n.geoPoint.latitude,centerLng:n.geoPoint.longitude},function(e){var t=e.loading,a=e.locations;o.setState({loading:t,nearbyHotels:a||[]})}),n&&w.createElement("div",{style:{width:"100%",height:"100%"}},w.createElement(T,{defaultAlsoShowOptions:(t={},f()(t,I.AlsoShowValues.restaurants,s),f()(t,I.AlsoShowValues.thingsToDo,s),f()(t,I.AlsoShowValues.hotels,i),t),detailLocation:n,onClose:this.props.onClose,loading:this.state.loading,nearbyHotels:this.state.nearbyHotels,onRedoSearch:this.performSearch})))}}]),t}(w.PureComponent),J=function e(){return window&&window.location&&"#MAPVIEW"===window.location.hash},$=function(e){function t(){var e,o;n()(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return o=l()(this,(e=u()(t)).call.apply(e,[this].concat(r))),f()(m()(m()(o)),"state",{showMap:!1}),f()(m()(m()(o)),"hasPushedHash",!1),f()(m()(m()(o)),"mapRadio",null),f()(m()(m()(o)),"openMap",function(){k()({module:"map_view",action:"open_requested",context:"v4"}),history.pushState(null,document.title,"#MAPVIEW"),o.hasPushedHash=!0,o.checkHash()}),f()(m()(m()(o)),"checkHash",function(){var e=J();o.setState({showMap:e})}),o}return p()(t,e),s()(t,[{key:"componentDidMount",value:function e(){this.mapRadio=S()("hr-map"),this.mapRadio&&this.mapRadio.on("open-trigger-clicked",this.openMap),this.setState({showMap:J()}),window.addEventListener("popstate",this.checkHash),window.addEventListener("hashchange",this.checkHash,!1)}},{key:"componentWillUnmount",value:function e(){window.removeEventListener("popstate",this.checkHash),window.removeEventListener("hashchange",this.checkHash),this.mapRadio&&this.mapRadio.off("open-trigger-clicked",this.openMap)}},{key:"render",value:function e(){var t=this,o=function e(){t.hasPushedHash?(window.history.back(),t.checkHash()):(function e(){var t=window.location.toString();if(t.indexOf("#")>0){var o=t.substring(0,t.indexOf("#"));window.history.replaceState(null,document.title,o)}}(),t.checkHash())};return w.createElement(w.Fragment,null,w.createElement(E.a,null,function(e){var a=e.locationId,n=e.geoId;return a?t.state.showMap&&w.createElement(M.a,{onClose:o},w.createElement("div",{className:"hotels-hotel-review-map-MapOpener__mapModalContainer--1pUtC"},w.createElement(Z,{onClose:o,locationId:a,geoId:n}))):null}))}}]),t}(w.PureComponent);t.default=$}}});
//# sourceMappingURL=hotels.hotel-review-map.2945b25601.js.map