(window.$WP=window.$WP||[]).push({id:"@ta/public.data-api-polling",d:["ta-platform","vendor-babel","vendor-react-libs"],e:["./packages/public/data-api-polling/data-api-polling.jsx"],x:{"./packages/public/data-api-polling/data-api-polling.jsx":["requestCallback","requestApiCall","bindDataApiPoller","default"]},m:{"./packages/public/data-api-polling/data-api-polling.jsx":function(e,r,t){"use strict";t.r(r);var n=t("@ta/common.api"),a=new Map,l=!1,s=null,i=null,u=null,o=function e(){l=!0;var r=a.get(0);if(r&&r.length>0){a.set(0,[]);for(var t=[],n=0;n<r.length;++n){var s=r[n];if(s)try{s()}catch(e){t.push(e)}}if(t.length>0)throw setTimeout(e,0),t[Math.floor(Math.random()*t.length)];var i=a.get(0);if(i&&i.length>0)return void setTimeout(e,0)}l=!1;var o=a;a=new Map,o.forEach(function(r,t){r&&r.length>0&&setTimeout(function(){var t=l;l=!0;for(var n=0;n<r.length;++n)c(r[n],0);t||e()},t)}),u&&u()},c=function e(r,t){if(r){t&&t>0||(t=0);var n=a.get(t);n||(n=[],a.set(t,n)),n.push(r),l||(l=!0,setTimeout(o,0))}},d=function e(r){if(!r)return Promise.resolve(null);if(!(s&&i&&u)){u&&u(),u=null;var t=new n.ApiCaller;s=t,i=new Promise(function(e,r){u=function n(){try{u=null,s=null,i=null,e(t.resolve())}catch(e){r(e)}}})}var a=s.stager(r);return i.then(function(e){var t=e;return(t=(t=t&&t[a])&&t[r])?t.body:null})},p=t("@babel/runtime/helpers/esm/classCallCheck"),h=t.n(p),g=t("@babel/runtime/helpers/esm/possibleConstructorReturn"),v=t.n(g),f=t("@babel/runtime/helpers/esm/getPrototypeOf"),m=t.n(f),U=t("@babel/runtime/helpers/esm/createClass"),q=t.n(U),B=t("@babel/runtime/helpers/esm/inherits"),b=t.n(B),R=t("@babel/runtime/helpers/esm/assertThisInitialized"),D=t.n(R),N=t("@babel/runtime/helpers/esm/defineProperty"),P=t.n(N),k=t("react"),y=[1e3,1e3,1e3,1e3,1500,1500,1500,2e3,2e3,2e3,5e3,1e4,1e4,1e4,1e4],C=/&puid=[^&]+/g,w=function e(r,t){return r===t||(r&&t?r.replace(C,"")===t.replace(C,""):!r&&!t)},T=function(e){function r(e){var t;return h()(this,r),t=v()(this,m()(r).call(this,e)),P()(D()(D()(t)),"triggerPending",void 0),P()(D()(D()(t)),"pollPending",void 0),P()(D()(D()(t)),"callbackRef",void 0),t.state={currentBaseUrl:e.currentBaseUrl,currentReqNum:null,requestedUrl:null,requestedReqNum:null,override:e.stagedUrl!==e.currentBaseUrl,overrideDataBaseUrl:null,overrideDataReqNum:null,overrideData:null},t.triggerPending=!1,t.pollPending=!1,t.callbackRef=[D()(D()(t))],t}return b()(r,e),q()(r,null,[{key:"getDerivedStateFromProps",value:function e(r,t){return!r.currentBaseUrl&&t.currentBaseUrl?{override:!0,currentBaseUrl:r.currentBaseUrl,currentReqNum:null,overrideDataBaseUrl:null,overrideDataReqNum:null,overrideData:null}:t.override||r.stagedUrl===r.currentBaseUrl?r.currentBaseUrl!==t.currentBaseUrl?w(r.currentBaseUrl,t.currentBaseUrl)?{currentBaseUrl:r.currentBaseUrl}:{currentBaseUrl:r.currentBaseUrl,currentReqNum:null}:null:!r.stagedLoading&&w(r.stagedUrl,r.currentBaseUrl)?{override:!0,currentBaseUrl:r.currentBaseUrl,currentReqNum:null,overrideDataBaseUrl:r.currentBaseUrl,overrideDataReqNum:null,overrideData:r.stagedData}:{override:!0,currentBaseUrl:r.currentBaseUrl,currentReqNum:null}}}]),q()(r,[{key:"onTrigger",value:function e(){this.triggerPending=!1;var r=this.state.currentBaseUrl,t=this.state.currentReqNum,n=this.callbackRef;if(this.state.requestedUrl!==r||t&&t>(this.state.requestedReqNum||0)){var a=r;if(a&&t&&t>1&&(a=this.props.pollingUrlGenerator(t)),!a)return void this.setState({override:!0,requestedUrl:r,requestedReqNum:t,overrideData:null,overrideDataBaseUrl:r,overrideDataReqNum:t});this.setState({requestedUrl:r,requestedReqNum:t}),d(a).then(function(e){return n[0]&&n[0].processResponse(r,t,a,e)},function(e){return n[0]&&n[0].processResponse(r,t,a,null)})}}},{key:"processResponse",value:function e(r,t,n,a){r===this.state.requestedUrl&&t===this.state.requestedReqNum&&(this.pollPending=!1,this.setState({override:!0,overrideData:a||null,overrideDataBaseUrl:r,overrideDataReqNum:t}))}},{key:"triggerPoll",value:function e(r,t){w(this.state.currentBaseUrl,r)&&(t||1)>=(this.state.currentReqNum||1)&&this.setState({currentReqNum:(t||1)+1})}},{key:"render",value:function e(){if(!this.state.currentBaseUrl)return this.props.renderer(!1,null);var r=this.state.overrideData,t=this.state.overrideDataBaseUrl!==this.state.currentBaseUrl,n=t||(this.state.currentReqNum||0)>(this.state.overrideDataReqNum||0);t&&!this.state.override&&this.props.stagedUrl===this.state.currentBaseUrl&&(r=this.props.stagedData,t=this.props.stagedLoading,n=(this.state.currentReqNum||0)>1);var a=this.callbackRef;if(n)this.triggerPending||this.state.currentBaseUrl===this.state.requestedUrl&&this.state.currentReqNum===this.state.requestedReqNum||(this.triggerPending=!0,c(function(){return a[0]&&a[0].onTrigger()},0));else if(!t&&!this.pollPending&&this.state.currentBaseUrl&&!this.props.completionPredicate(r)){var l=this.state.currentBaseUrl,s=this.state.currentReqNum||1;s<y.length&&(this.pollPending=!0,c(function(){return a[0]&&a[0].triggerPoll(l,s)},y[s]))}return this.props.renderer(!r||t,r)}},{key:"componentWillUnmount",value:function e(){this.callbackRef[0]=null}}]),r}(k.Component),A=function e(r,t,a,l){var s=null;return Object(n.bind)({data:function e(n,i){var u=(s=s||r(n,null))?i(s):null;return l&&"function"==typeof l&&l(n,i),function(e){var l=u&&u.get()||{data:null,loading:!1};return{completionPredicate:t,currentBaseUrl:r(n,null),stagedUrl:s,stagedLoading:l.loading,stagedData:l.data,pollingUrlGenerator:function t(n){return r(e,n)},renderer:function r(t,n){return a(e,t,n)}}}},actions:null})(T)};t.d(r,"requestCallback",function(){return c}),t.d(r,"requestApiCall",function(){return d}),t.d(r,"bindDataApiPoller",function(){return A}),r.default=null}}});
//# sourceMappingURL=public.data-api-polling.9f31c48095.js.map