(window.$WP=window.$WP||[]).push({id:"@ta/memx.google-onetap",d:["vendor-babel","vendor-react-libs","@ta/social.onboarding-state","ta-platform","@ta/memx.registration-dialog-utils","vendor-common","ta-common"],e:["./packages/memx/google-onetap/GoogleOneTapLoader.jsx"],x:{"./packages/memx/google-onetap/GoogleOneTapLoader.jsx":["default"]},m:{"./packages/memx/google-onetap/GoogleOneTapLoader.jsx":function(e,o,t){"use strict";t.r(o);var a=t("@babel/runtime/helpers/esm/classCallCheck"),n=t.n(a),s=t("@babel/runtime/helpers/esm/possibleConstructorReturn"),r=t.n(s),l=t("@babel/runtime/helpers/esm/getPrototypeOf"),i=t.n(l),g=t("@babel/runtime/helpers/esm/createClass"),c=t.n(g),u=t("@babel/runtime/helpers/esm/inherits"),p=t.n(u),d=t("@babel/runtime/helpers/esm/assertThisInitialized"),m=t.n(d),_=t("@babel/runtime/helpers/esm/defineProperty"),h=t.n(_),b=t("react"),f=t("react-redux"),O=t("@ta/social.onboarding-state"),v=t("@ta/common.features"),x=t("@ta/common.tracking"),y=t.n(x),k=t("@ta/memx.registration-dialog-utils"),T=t("lodash/get"),A=t.n(T),C={yoloIframeBase:"memx-google-onetap-GoogleOneTapLoader__yoloIframeBase--XtJgm",yoloIframeContextualMessageAdjacentDW:"memx-google-onetap-GoogleOneTapLoader__yoloIframeContextualMessageAdjacentDW--2KfUM"},E=t("@ta/common.classnames"),M=t.n(E),I=t("@ta/styleguide.icon"),w=t("@ta/common.i18n"),N=Object(f.connect)(function(e,o){return{servlet:e.meta.initialServletName,bottomPosition:o.bottomPosition}})(function e(o){var t=function a(){return{headline:Object(w.localize)("onetap_message_unlock"),subhead:Object(w.localize)("onetap_message_subhead_to_get_the_most")}}(),n=o.bottomPosition||0;return Object(v.featureIsEnabled)("google_onetap_contextual_message_mobile")&&n?b.createElement("div",{className:M()("memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageContainer--2MPRe","memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageMobileDevice--3b5il"),style:{bottom:"".concat(n,"px")}},b.createElement("div",{className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageInnerContainer--1GpCH"},b.createElement("h3",{className:"memx-google-onetap-GoogleOneTapContextualMessage__headline--19hK6"},b.createElement(I.Icon,{name:"lock-fill",className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapIcon--1Nsdz"}),t.headline))):b.createElement("div",{className:M()("memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageContainer--2MPRe","memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageDesktopTablet--zsYLB")},b.createElement("div",{className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageInnerContainer--1GpCH"},b.createElement("h3",{className:"memx-google-onetap-GoogleOneTapContextualMessage__headline--19hK6"},b.createElement(I.Icon,{name:"lock-fill",className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapIcon--1Nsdz"}),t.headline),b.createElement("p",{className:"memx-google-onetap-GoogleOneTapContextualMessage__subhead--YO-_R"},t.subhead)))}),G=t("@ta/common.logging"),j=t.n(G),S=["Home","Tourism","MobileTourism","ShowTopic","MobileShowTopic"];function L(e){j.a.warn("Unknown error processing Google onetap request - type, message: ".concat(e.type,", ").concat(e.message))}function R(){return Object(v.featureIsEnabled)("google_onetap_contextual_message_desktop")||Object(v.featureIsEnabled)("google_onetap_contextual_message_mobile")}var P=0,H="hint",q=5e3,B={supportedAuthMethods:["https://accounts.google.com"],supportedIdTokenProviders:[{uri:"https://accounts.google.com",clientId:"1070328450902.apps.googleusercontent.com"}]},F=function(e){function o(e){var t;return n()(this,o),t=r()(this,i()(o).call(this,e)),h()(m()(m()(t)),"onGoogleYoloLoad",function(e){return t.googleyolo=e,Object(v.featureIsEnabled)("google_onetap_timeouts")&&t.googleyolo.setTimeouts(q),t.googleyolo.setRenderMode&&!Object(v.featureIsEnabled)("mobile_web")&&t.googleyolo.setRenderMode("navPopout"),(t.props.adhesionRendered||R())&&o.observeYoloIframeExists().then(t.onYoloIframeInserted),t.props.adhesionRendered&&t.trackAction("google_onetap_adhesion_detected"),Object(v.featureIsEnabled)("google_onetap_web_component_autologin")?t.retrieve():t.hint()}),h()(m()(m()(t)),"onYoloIframeInserted",function(e){t.iframeNode=e,e.classList.add(C.yoloIframeBase),Object(v.featureIsEnabled)("google_onetap_contextual_message_desktop")&&t.state.loginType===H&&e.classList.add(C.yoloIframeContextualMessageAdjacentDW),t.initializeIframeAttributeListener(e,function(e){t.setState({googleOneTapHeight:e}),e>0&&t.props.adhesionRendered&&(t.moveGoogleOneTapIframeForAdhesion(),Object(k.moveAdCloseX)(!1),t.trackAction("google_onetap_modal_moved_above_adhesion"))})}),h()(m()(m()(t)),"googleyolo",void 0),h()(m()(m()(t)),"iframeAttributeObserver",void 0),h()(m()(m()(t)),"iframeNode",void 0),h()(m()(m()(t)),"handleAutoLoginException",function(e){t.resetContextualMessageState(),t.trackAction("google_onetap_autologin_exception"),L(e),t.props.triggerNext()}),h()(m()(m()(t)),"handleOneTapHintException",function(e){t.resetContextualMessageState(),t.trackAction("google_onetap_hint_exception"),L(e),t.props.triggerNext()}),h()(m()(m()(t)),"handleAutoLoginSuccess",function(e){t.resetContextualMessageState(),e.idToken&&(t.trackAction("google_onetap_autologin_selected"),Object(k.moveAdCloseX)(!0),t.showRegOverlay(e))}),h()(m()(m()(t)),"handleOneTapSuccess",function(e){t.resetContextualMessageState(),e.idToken&&(t.trackAction("google_onetap_hint_selected"),Object(k.moveAdCloseX)(!0),t.showRegOverlay(e))}),h()(m()(m()(t)),"handleAutoLoginError",function(e){switch(Object(k.moveAdCloseX)(!0),e.type){case"userCanceled":t.resetContextualMessageState(),t.trackAction("google_onetap_autologin_closed"),t.props.onDismiss();break;case"noCredentialsAvailable":t.resetContextualMessageState(!1),t.trackAction("google_onetap_autologin_no_credentials"),t.hint();break;case"requestFailed":t.resetContextualMessageState(),t.trackAction("google_onetap_autologin_request_failed"),t.props.triggerNext();break;case"unsupportedBrowser":t.resetContextualMessageState(),t.trackAction("google_onetap_autologin_unsupported_browser"),t.props.triggerNext();break;case"operationCanceled":break;case"illegalConcurrentRequest":case"initializationError":case"configurationError":default:t.resetContextualMessageState(),t.trackAction("google_onetap_autologin_unknown_error"),L(e),t.props.triggerNext()}}),h()(m()(m()(t)),"handleOneTapError",function(e){switch(t.resetContextualMessageState(),Object(k.moveAdCloseX)(!0),e.type){case"userCanceled":t.trackAction("google_onetap_hint_closed"),t.props.onDismiss();break;case"noCredentialsAvailable":t.trackAction("google_onetap_hint_no_credentials"),t.props.triggerNext();break;case"requestFailed":t.trackAction("google_onetap_hint_request_failed"),t.props.triggerNext();break;case"unsupportedBrowser":t.trackAction("google_onetap_hint_unsupported_browser"),t.props.triggerNext();break;case"operationCanceled":break;case"illegalConcurrentRequest":case"initializationError":case"configurationError":default:t.trackAction("google_onetap_hint_unknown_error"),t.props.triggerNext(),L(e)}}),t.state={hasOneTapAlreadyLoaded:!1,loginType:null,googleOneTapHeight:P},t.iframeAttributeObserver=null,t.iframeNode=null,t}return p()(o,e),c()(o,null,[{key:"observeYoloIframeExists",value:function e(){return new Promise(function(e){var o=new MutationObserver(function(t){t.forEach(function(t){t.addedNodes&&Array.prototype.forEach.call(t.addedNodes,function(t){"IFRAME"===t.nodeName&&t.src.includes("smartlock.google.com/iframe/")&&(o.disconnect(),e(t))})})});o.observe(window.document.body,{childList:!0})})}}]),c()(o,[{key:"componentDidMount",value:function e(){!function o(e,t){return!!function a(e){return!Object(v.featureIsEnabled)("google_onetap_web_component_hotel_servlets")&&k.HOTEL_SERVLETS.includes(e)}(t)||!!function n(){return!Object(v.featureIsEnabled)("google_onetap_web_component_mobile_adhesion")&&Object(v.featureIsEnabled)("mobile_fixed_ad")}()||!Object(v.featureIsEnabled)("google_onetap_web_component_mobile")&&!Object(v.featureIsEnabled)("google_onetap_web_component_desktop")}(this.props.viewportCategory,this.props.servlet)?this.setupGoogleOneTap():this.props.triggerNext()}},{key:"componentDidUpdate",value:function e(o){o.adhesionRendered&&!this.props.adhesionRendered&&this.moveGoogleOneTapIframeForAdhesion()}},{key:"componentWillUnmount",value:function e(){this.dismissGoogleOneTap()}},{key:"setupGoogleOneTap",value:function e(){this.trackAction("google_onetap_requested"),(S.includes(this.props.servlet)||Object(v.featureIsEnabled)("google_onetap_web_component"))&&this.loadGoogleJavascript()}},{key:"initializeIframeAttributeListener",value:function e(o,t){this.iframeAttributeObserver=new MutationObserver(function(e){var o=parseInt(A()(e,"[0].target.style.height",0),10);t&&t(isNaN(o)?0:o)}),this.iframeAttributeObserver.observe(o,{attributes:!0})}},{key:"moveGoogleOneTapIframeForAdhesion",value:function e(){var o=document.getElementsByClassName(C.yoloIframeBase);if(o&&0!==o.length){var t=this.props.adhesionRendered?50:0;o[0].style.bottom="".concat(t,"px")}}},{key:"calculateMessageBottomPosition",value:function e(){return(this.props.adhesionRendered?50:0)+this.state.googleOneTapHeight-39}},{key:"resetContextualMessageState",value:function e(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.iframeAttributeObserver&&this.iframeAttributeObserver.disconnect(),null!==this.state.loginType&&this.state.googleOneTapHeight!==P&&this.setState({loginType:null,googleOneTapHeight:P})}},{key:"loadGoogleJavascript",value:function e(){if(!this.state.hasOneTapAlreadyLoaded&&(this.state.hasOneTapAlreadyLoaded=!0,window.onGoogleYoloLoad=this.onGoogleYoloLoad,null===document.getElementById("google-smartlock-api-js"))){var o=document.createElement("script");o.id="google-smartlock-api-js",o.src="https://smartlock.google.com/client",o.async=!0,null!=document.body&&document.body.appendChild(o)}}},{key:"dismissGoogleOneTap",value:function e(){window.onGoogleYoloLoad=void 0,this.googleyolo&&this.googleyolo.cancelLastOperation(),this.resetContextualMessageState()}},{key:"retrieve",value:function e(){return this.setState({loginType:"retrieve"}),this.trackAction("google_onetap_autologin_requested"),this.googleyolo.retrieve(B).then(this.handleAutoLoginSuccess,this.handleAutoLoginError).catch(this.handleAutoLoginException)}},{key:"hint",value:function e(){return this.setState({loginType:H}),Object(v.featureIsEnabled)("google_onetap_contextual_message_desktop")&&this.iframeNode&&this.iframeNode.classList.add(C.yoloIframeContextualMessageAdjacentDW),this.trackAction("google_onetap_hint_requested"),this.googleyolo.hint(B).then(this.handleOneTapSuccess,this.handleOneTapError).catch(this.handleOneTapHintException)}},{key:"showRegOverlay",value:function e(o){var t=this;window.require(["ta/registration/RegOverlay"],function(e){var a="MOBILE"===t.props.viewportCategory;e.showRegOverlay(null,null,a,{flow:"GOOGLE_ONETAP",pid:40185,userRequestedForce:"true",extraQueryParams:{google_id_token:o.idToken},displayOnShowOverlay:!0,onSuccess:function e(o){o&&o.user_id&&("Home"!==t.props.servlet?Object(v.featureIsEnabled)("google_onetap_user_display_prompt")&&t.props.setShouldFire(!1,"GOOGLE_ONETAP_NON_HOME"):t.props.setShouldFire(!1,"GOOGLE_ONETAP"))}})})}},{key:"trackAction",value:function e(o){y()({module:"google_onetap",action:o,context:"".concat(o.replace(/^google_onetap_/,""),"_").concat(this.props.servlet||"unknown"),value:40185})}},{key:"render",value:function e(){return this.state.loginType!==H||!R()||this.state.googleOneTapHeight<=0?null:b.createElement(N,{bottomPosition:this.calculateMessageBottomPosition()})}}]),o}(b.Component);o.default=Object(f.connect)(function(e){return{isMember:e.auth.isMember,servlet:e.meta.initialServletName,viewportCategory:e.meta.device.viewportCategory}},{setShouldFire:O.ACTIONS.setShouldFire})(F)}}});
//# sourceMappingURL=memx.google-onetap.5e72e6c127.js.map